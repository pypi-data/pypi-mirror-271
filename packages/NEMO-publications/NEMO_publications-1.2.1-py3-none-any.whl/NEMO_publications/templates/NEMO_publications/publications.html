{% extends 'NEMO_publications/publications_base.html' %}
{% load custom_tags_and_filters %}
{% block add_button %}
	{% url 'search_publication' as create_publication_url %}
	{% button type="add" value="Add" url=create_publication_url %}
{% endblock %}
{% block before_pagination %}
	<div class="col-sm-12" style="margin-left: -15px;">
		<div class="checkbox">
			<span class="control-label">Columns:</span>
			<label><input id="publications_col_2" type="checkbox" onchange="toggle_column(2, this.checked)">Journal</label>
			<label><input id="publications_col_3" type="checkbox" onchange="toggle_column(3, this.checked)">Month</label>
			<label><input id="publications_col_4" type="checkbox" onchange="toggle_column(4, this.checked)">Year</label>
			<label><input id="publications_col_5" type="checkbox" onchange="toggle_column(5, this.checked)">Doi</label>
		</div>
	</div>
	<script>
        function toggle_column(column_number, checked)
		{
            $("#publications_col_"+column_number).prop("checked", checked);
            localStorage.setItem("publications_col_"+column_number, ""+checked);
            $('#publication_table td:nth-child(' + column_number + '),#publication_table th:nth-child(' + column_number + ')').toggle(checked);
        }
        window.addEventListener('load', function () {
			toggle_column(2, localStorage.getItem("publications_col_2") === "true");
			toggle_column(3, localStorage.getItem("publications_col_3") === "true");
			toggle_column(4, localStorage.getItem("publications_col_4") === "true");
			toggle_column(5, localStorage.getItem("publications_col_5") === "true");
        })
	</script>
	{{ block.super }}
{% endblock %}
{% block pagination_content %}
    <table id="publication_table" class="table table-bordered table-condensed table-align-top table-striped table-hover thead-light" style="margin-bottom: 0">
        <thead>
            <tr>
                <th style="min-width: 300px;">{% include 'pagination/pagination_column.html' with order_by='title' name='Title' %}</th>
                <th style="display: none">{% include 'pagination/pagination_column.html' with order_by='journal' name='Journal' %}</th>
                <th style="display: none">{% include 'pagination/pagination_column.html' with order_by='month' name='Month' %}</th>
                <th style="display: none">{% include 'pagination/pagination_column.html' with order_by='year' name='Year' %}</th>
                <th style="display: none">{% include 'pagination/pagination_column.html' with order_by='doi' name='DOI' %}</th>
                <th>Authors</th>
				<th>Tools</th>
				<th>Projects</th>
                <th class="text-right button-column-minimum">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for publication in page %}
				{% with user_data|get_item:publication.id as user_data_entry %}
					<tr>
						<td><a href="{{ publication.get_doi_url }}" target="_blank">{{ publication.title }}</a></td>
						<td style="display: none">{{ publication.journal }}</td>
						<td class="text-nowrap" style="display: none">{{ publication.get_month_display|default_if_none:''|title }}</td>
						<td class="text-nowrap" style="display: none">{{ publication.year }}</td>
						<td class="text-nowrap" style="display: none"><a href="{{ publication.get_doi_url }}" target="_blank">{{ publication.doi }}</a></td>
						<td class="text-nowrap">
							{% for author in publication.get_authors.all %}
								<span>{{ author }}</span>
								<br>
							{% endfor %}
						</td>
						<td class="text-nowrap">
							{% for tool in publication.get_tools.all %}
								<span>{{ tool }}</span>
								<br>
							{% endfor %}
						</td>
						<td class="text-nowrap">
							{% for project in publication.get_projects.all %}
								<span>{{ project }}</span>
								<br>
							{% endfor %}
						</td>
						<td class="text-right text-nowrap">
							{% if user_data_entry %}
								{% url 'edit_publication' user_data_entry.id as edit_publication_url %}
								{% button type="edit" value="Edit" size="small" title="Edit" url=edit_publication_url %}
								<form method="post" style="display: inline" action="{% url 'delete_publication' user_data_entry.id %}">
									{% csrf_token %}
									{% button type="delete" submit="true" size="small" value="Remove my info" title="Remove" onclick="return confirm('Are you sure you want to remove your information from this publication?');" %}
								</form>
							{% else %}
								{% url 'create_publication' publication.id as create_publication_data_url %}
								{% button type="add" size="small" submit="true" value="Add Information"  url=create_publication_data_url  %}
							{% endif %}
						</td>
					</tr>
				{% endwith %}
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
{% block table_empty_content %}There are no publications.{% endblock %}