"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[4493],{86874:(e,t,r)=>{r.r(t),r.d(t,{canOpenDrillthroughOnSelection:()=>y,getDrillthroughWidgetFilters:()=>D,pluginMenuItemOpenDrillthrough:()=>M});var n=r(63612),i=r(31529),l=r(93345),a=r(12166),u=r(21900),o=r(11813),s=r(2563),m=r(41958),d=r(66003),h=r(37236),c=r(51728),g=r(60824),p=r(26353),f=r(26771),b=r(60125);function y(e){return void 0!==e&&!(e.axes&&e.axes.length>0)&&void 0!==e.cells&&1===e.cells.length&&void 0!==e.cells[0].value}var C=r(34531),x=r(56093),v=r(64164);function N(e,t){const{dimensionName:r,hierarchyName:n}=e;return t.some((e=>(0,v.q)(e,{dimensionName:r,hierarchyName:n})))}function D({sourceWidgetFilters:e,tuple:t}){return[...(e||[]).filter((e=>!N(e,t))),...t.map((({dimensionName:e,hierarchyName:t,namePath:r})=>({type:"members",dimensionName:e,hierarchyName:t,members:[r]})))]}const M={key:"open-drillthrough",useMenuItem:e=>{const{selection:t,widgetState:r}=e,{cube:v,serverKey:M}=(0,b.useCube)(r),{formatMessage:S}=(0,a.useIntl)(),q=(0,d.g)(),k=(0,l.useMemo)((()=>{if(y(t))return t.cells[0].tuple.filter((e=>"Measures"===e.dimensionName||!(0,o.isTotal)((0,g.q)(e,v),e)))}),[v,t]),O=(0,l.useMemo)((()=>{if(k){const e=k.filter((e=>"Measures"!==e.dimensionName));return S({id:"aui.plugins.menu-item.open-drillthrough.openDrillthrough"},{member:e.length>0?(0,o.getTupleCaption)(e,{captionForTotals:S({id:"aui.total"}),cube:v,separator:", ",hasOnlyCaptionForLeafLevels:!0}):void 0})}}),[S,k,v]),[W]=(0,s.i)("drillthrough.defaultSelectedColumns"),[_]=(0,m.N)(M,v.name),w=(0,l.useMemo)((()=>{const e=(0,f.h)(_??[]);return(0,i.flatten)(["numeric","regular","date"].map((t=>e[t]??[])))}),[_]),F=(0,l.useCallback)((async()=>{if(q&&O&&k&&(0,u.M)(e)){const t=(0,h.z)(e.dashboardState.pagesOrder),n=e.dashboardState.pagesOrder.indexOf(q),l=e.dashboardState.pages[q];if(void 0===r.query.mdx)return;const a=function({name:e,sourceWidget:t,sourceWidgetPage:r,tuple:n,drillthroughColumns:l,defaultSelectedColumns:a,cube:u}){const o=D({sourceWidgetFilters:t.filters,tuple:n}),s=(0,i.map)(l,"name"),m=a[u.name]?(0,i.intersection)(s,a[u.name]):s,d={mdx:(0,C.I)((0,b.getDefaultMdxDrillthrough)(u.name),{drillthroughColumnUniqueNames:m})};t.query.mdx&&t.query.mdx.withClause&&(d.mdx.select.withClause=t.query.mdx.withClause);const h=(r.filters||[]).filter((e=>!N(e,n)));return{name:e,content:{0:{...x._.initialState,query:d,serverKey:t.serverKey,initialCubeName:u.name,filters:o}},layout:{direction:"column",children:[{leafKey:"0",size:1}]},filters:h}}({name:O,sourceWidget:r,sourceWidgetPage:l,tuple:k,drillthroughColumns:w,defaultSelectedColumns:W,cube:v}),u=(0,c.H)(e.dashboardState,{page:a,key:t,index:n+1});e.onDashboardChange(u),e.onActivePageChange(t)}}),[q,v,O,e,k,r,W,w]);if((0,u.M)(e)&&k&&r.query.mdx)return{icon:(0,n.Y)(p.IconDrillthrough,{}),label:O,onClick:F}},translations:{"en-US":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {on {member}}\n          }"},"fr-FR":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {sur {member}}\n          }"}}}}}]);