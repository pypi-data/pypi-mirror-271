/// Files: arch/x86/mm/mmap.c fs/binfmt_elf.c
/// Fix: 4e7c22d447bb6d7e37bfe39ff658486ae78e8d77
/// Fixes: v2.6.12-rc2

virtual detect

@err_stack_maxrandom_size exists@
position p;
@@

* unsigned int stack_maxrandom_size@p(void)
{
	...
}

@err_randomize_stack_top exists@
identifier random_variable;
position p;
@@

*	unsigned int random_variable = 0;
	...
(
*	random_variable =@p get_random_int() % ...;
|
*	random_variable =@p get_random_int() & ...;
)

@script:python depends on detect@
p << err_stack_maxrandom_size.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2015-1593')

@script:python depends on detect@
p << err_randomize_stack_top.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2015-1593')
