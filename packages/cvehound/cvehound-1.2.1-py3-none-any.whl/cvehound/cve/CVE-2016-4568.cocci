/// Files: drivers/media/v4l2-core/videobuf2-v4l2.c drivers/media/common/videobuf2/videobuf2-v4l2.c drivers/media/v4l2-core/videobuf2-core.c
/// Fix: 2c1f6951a8a82e6de0d82b1158b5e493fc6c54ab
/// Fixes: b0e0e1f83de31aa0428c38b692c590cc0ecd3f03
/// Version: 1.0.7

virtual detect

@plane_array_check@
identifier __verify_planes_array_core, vb, pb;
@@

__verify_planes_array_core(struct vb2_buffer *vb, const void *pb)
{
	...
*	__verify_planes_array(vb, pb)
	...
}

@fix@
identifier plane_array_check.__verify_planes_array_core;
symbol v4l2_buf_ops;
@@

struct vb2_buf_ops v4l2_buf_ops = {
	...,
*	.verify_planes_array = __verify_planes_array_core,
	...
};

@err depends on !fix@
symbol v4l2_buf_ops;
position p;
@@

struct vb2_buf_ops v4l2_buf_ops =@p {
	...
};

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2016-4568')
