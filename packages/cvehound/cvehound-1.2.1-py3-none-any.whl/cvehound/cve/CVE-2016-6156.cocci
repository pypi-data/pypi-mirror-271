/// Files: drivers/platform/chrome/cros_ec_dev.c
/// Fix: 096cdc6f52225835ff503f987a0d68ef770bb78e
/// Fixes: a841178445bb72a3d566b4e6ab9d19e9b002eb47

virtual detect

@err@
identifier u_cmd, s_cmd, arg;
position p;
@@

ec_device_ioctl_xcmd(..., void *arg)
{
	...
*	copy_from_user(&u_cmd, arg, sizeof(u_cmd))
	...
*	copy_from_user(s_cmd, arg, sizeof(*s_cmd) + u_cmd.outsize)
	... when != if (u_cmd.outsize != s_cmd->outsize || u_cmd.insize != s_cmd->insize) { ret = -EINVAL; goto exit; }
*	copy_to_user@p(arg, s_cmd, sizeof(*s_cmd) + u_cmd.insize)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2016-6156')
