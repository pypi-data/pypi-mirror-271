/// Files: net/ipv6/icmp.c
/// Fix: 79dc7e3f1cd323be4c81aa1a94faa1b3ed987fb2
/// Detect-To: ca254490c8dfdaddb5df8a763774db0f4c5200c3

virtual detect

@err@
identifier skb, iff, addr_type, fl6;
position p;
@@

icmp6_send(struct sk_buff *skb, ...)
{
	...
(
	if (__ipv6_addr_needs_scope_id(addr_type))
 		iif = skb->dev->ifindex;
	else
*		iif = l3mdev_master_ifindex(\(skb_dst(skb)@p->dev\|skb@p->dev\));
|
	if (!fl6.flowi6_oif)
*		fl6.flowi6_oif = l3mdev_master_ifindex(skb@p->dev);
)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2016-9919')
