/// Files: net/ipv4/ip_sockglue.c net/ipv4/ip_options.c
/// Fix: 34b2cef20f19c87999fff3da4071e66937db9644
/// Fixes: d826eb14ecef3574b6b3be55e5f4329f4a76fbf3

virtual detect

@not_net@
identifier dpot, skb;
@@

* \(__ip_options_echo\|ip_options_echo\)(struct ip_options *dopt,
					 struct sk_buff *skb, ...)
{
	...
*	dev_net(skb_dst(skb)->dev)
	...
}

@err depends on not_net@
identifier skb;
position p;
@@

ipv4_pktinfo_prepare(..., struct sk_buff *skb)
{
	...
*	skb_dst_drop@p(skb);
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2017-5970')
