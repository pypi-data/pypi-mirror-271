/// Files: net/ipv4/tcp.c
/// Fix: ccf7abb93af09ad0868ae9033d1ca8108bdaec82
/// Fixes: 9c55e01c0cc835818475a6ce8c4d684df9949ac8

virtual detect

@err@
identifier tss, sk, ret;
position p;
@@

tcp_splice_read(...)
{
	...
*	while (tss.len) {
*		ret = __tcp_splice_read(sk, &tss);
		if (ret < 0)
			break;
		else if (!ret) {
			... when != if (!skb_queue_empty(&sk->sk_receive_queue)) break;
*			sk_wait_data@p(sk, ...);
			...
		}
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2017-6214')
