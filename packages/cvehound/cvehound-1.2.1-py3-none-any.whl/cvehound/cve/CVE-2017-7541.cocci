/// Files: drivers/net/wireless/broadcom/brcm80211/brcmfmac/cfg80211.c
/// Fix: 8f44c9a41386729fea410e688959ddaa9d51be7c
/// Fixes: 18e2f61db3b708e0a22ccc403cb6ab2203d6faab

virtual detect

@err@
identifier mgmt, action_frame, buf, exit, len;
statement S;
position p;
@@

brcmf_cfg80211_mgmt_tx(...)
{
	...
*	if (ieee80211_is_action(mgmt->frame_control)) {
		... when != if (len > BRCMF_FIL_ACTION_FRAME_SIZE + DOT11_MGMT_HDR_LEN) { ... goto exit; }
*		action_frame->len = cpu_to_le16(len - DOT11_MGMT_HDR_LEN);
		...
*		memcpy@p(action_frame->data, &buf[DOT11_MGMT_HDR_LEN], le16_to_cpu(action_frame->len));
		...
	} else
		S
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2017-7541')
