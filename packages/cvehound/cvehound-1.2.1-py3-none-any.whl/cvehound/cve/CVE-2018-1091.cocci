/// Files: arch/powerpc/kernel/ptrace.c
/// Fix: c1fa0768a8713b135848f78fd43ffc208d8ded70
/// Fixes: cd63f3cf1d59b7ad8419eba1cac8f9126e79cc43

virtual detect

@err exists@
identifier tsk;
symbol current;
position p;
@@

flush_tmregs_to_thread(struct task_struct *tsk)
{
	...
*	if (tsk !=@p current)
		return;
	...
	if (MSR_TM_SUSPENDED(mfmsr())) {
		tm_reclaim_current(TM_CAUSE_SIGNAL);
	} else {
		tm_enable();
		tm_save_sprs(...);
	}
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2018-1091')
