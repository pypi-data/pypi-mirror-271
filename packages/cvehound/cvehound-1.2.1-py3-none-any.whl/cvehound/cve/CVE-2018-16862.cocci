/// Files: mm/truncate.c
/// Fix: 6ff38bd40230af35e446239396e5fc8ebd6a5248
/// Fixes: 91b0abe36a7b2b3b02d7500925a5f8455334f0e5

virtual detect

@err@
identifier mapping, nrpages, nrexceptional;
position p;
@@

truncate_inode_pages_final(struct address_space *mapping)
{
	...
	if (nrpages || nrexceptional) {
(
		spin_lock_irq(&mapping->tree_lock);
		spin_unlock_irq(&mapping->tree_lock);
|
		xa_lock_irq(&mapping->i_pages);
		xa_unlock_irq(&mapping->i_pages);
)
*		truncate_inode_pages@p(mapping, 0);
	}
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2018-16862')
