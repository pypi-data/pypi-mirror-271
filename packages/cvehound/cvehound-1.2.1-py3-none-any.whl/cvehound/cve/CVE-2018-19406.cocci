/// Files: arch/x86/kvm/lapic.c
/// Fix: 38ab012f109caf10f471db1adf284e620dd8d701
/// Fixes: 4180bf1b655a791a0a6ef93a2ffffc762722c782

virtual detect

@err@
identifier kvm, count, out, map, min;
position p;
@@

kvm_pv_send_ipi(struct kvm *kvm, ...)
{
	...
*	map =@p rcu_dereference(kvm->arch.apic_map);
	... when != if (unlikely(!map)) { count = -EOPNOTSUPP; goto out; }
	kvm_apic_set_irq(...)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2018-19406')
