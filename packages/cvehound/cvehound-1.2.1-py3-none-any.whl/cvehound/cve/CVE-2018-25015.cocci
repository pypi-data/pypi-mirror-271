/// Files: net/sctp/socket.c
/// Fix: a0ff660058b88d12625a783ce9e5c1371c87951f
/// Fixes: cea0cc80a6777beb6eb643d4ad53690e1ad1d4ff

virtual detect

@err exists@
identifier orig_sk, sk, asoc;
position p;
@@

sctp_wait_for_sndbuf(struct sctp_association *asoc, ..., struct sock **orig_sk)
{
	...
	if (sk != asoc->base.sk) {
*		release_sock(sk);
*		sk = asoc->base.sk;
*		lock_sock@p(sk);
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2018-25015')
