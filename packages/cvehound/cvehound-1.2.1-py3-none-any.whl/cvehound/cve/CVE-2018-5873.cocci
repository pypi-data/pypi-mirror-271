/// Files: fs/nsfs.c
/// Fix: 073c516ff73557a8f7315066856c04b50383ac34
/// Fixes: e149ed2b805fefdccf7ccdfc19eca22fdd4514ac

virtual detect

@err@
identifier ns, dentry;
type T;
position p;
@@

\(__ns_get_path\|ns_get_path\)(...)
{
	...
*	dentry = d_alloc_pseudo(...);
	...
*	d_instantiate@p(dentry, ...);
	... when != dentry->d_flags |= DCACHE_RCUACCESS;
	atomic_long_cmpxchg(&ns->stashed, 0, (T)dentry)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2018-5873')
