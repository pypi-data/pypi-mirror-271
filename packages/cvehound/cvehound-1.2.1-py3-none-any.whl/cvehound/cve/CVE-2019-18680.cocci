/// Files: net/rds/tcp.c
/// Fix: 91573ae4aed0a49660abdad4d42f2a0db995ee5e
/// Fixes: c4e97b06cfdc5213494c22dd5c2b41ff8b15e0ee

virtual detect

@err@
identifier tc, sk, tmp_list, net, c_net;
symbol t_tcp_node;
iterator name list_for_each_entry_safe;
position p;
@@

rds_tcp_kill_sock(struct net *net)
{
	...
	list_for_each_entry_safe(tc, ..., t_tcp_node) {
		...
*		if (net != c_net)
			continue;
		...
		list_move_tail(&tc->t_tcp_node, &tmp_list);
		...
	}
	...
	list_for_each_entry_safe(tc, ..., &tmp_list, t_tcp_node) {
		... when != tc->t_sock != NULL
*		sk =@p tc->t_sock->sk;
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-18680')
