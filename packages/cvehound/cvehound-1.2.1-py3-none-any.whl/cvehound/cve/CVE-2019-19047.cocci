/// Files: drivers/net/ethernet/mellanox/mlx5/core/health.c
/// Fix: c7ed6d0183d5ea9bc31bcaeeba4070bd62546471
/// Fixes: 9b1f2982360579cbdb3069fa026f6cfc31c4388b
/// Version: 1.1.0

virtual detect

@err@
identifier cr_data, err, free_data;
position p;
@@

mlx5_fw_fatal_reporter_dump(...)
{
	...
*	cr_data = kvmalloc(...);
	...
*	err = mlx5_crdump_collect(...);
	... when != err;
*	if (err)
*		return err;@p
	...
free_data:
*	\(kfree\|kvfree\)(cr_data);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-19047')
