/// Files: net/packet/af_packet.c
/// Fix: b43d1f9f7067c6759b1051e8ecb84e82cef569fe
/// Fixes: f6fb8f100b807378fda19e83e5ac6828b638603a

virtual detect

@err exists@
identifier dev, err, mbits, blk_size_in_bytes;
position p;
@@

prb_calc_retire_blk_tmo(..., int blk_size_in_bytes)
{
	...
(
*	if (!dev->ethtool_ops->get_settings(dev, ...)) {
		...
		return DEFAULT_PRB_RETIRE_TOV;
		...
*	}@p
|
	err = \(__ethtool_get_link_ksettings\|__ethtool_get_settings\)(...);
	... when != err
*	if (!err) {
		...
		return DEFAULT_PRB_RETIRE_TOV;
		...
*	}@p
)
	...
	mbits = (blk_size_in_bytes * 8) / (1024 * 1024);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-20812')
