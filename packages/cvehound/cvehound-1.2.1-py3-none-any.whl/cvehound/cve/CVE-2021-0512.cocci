/// Files: drivers/hid/hid-core.c drivers/usb/input/hid-core.c
/// Fix: ed9be64eefe26d7d8b0b5b9fa3ffdf425d87a01f
/// Detect-To: v2.6.12-rc2

virtual detect

@err exists@
identifier report, usages, values;
position p;
@@

hid_register_field(struct hid_report *report, unsigned usages, unsigned values)
{
	...
	\(kmalloc\|kzalloc\)((sizeof(struct hid_field) +
 		 usages * sizeof(struct hid_usage) +
*		 values *@p sizeof(unsigned)),
		 ...)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-0512')
