/// Files: fs/btrfs/ctree.c
/// Fix: dbcc7d57bffc0c8cac9dac11bec548597d59a6a5
/// Fixes: 834328a8493079d15f30866ace42489463f52571

virtual detect

@err exists@
identifier old, eb;
position p;
@@

get_old_root(...)
{
	...
	old = read_tree_block(...);
	if (...) {
		...
	} else {
		... when != btrfs_tree_read_lock(old);
*		eb = btrfs_clone_extent_buffer@p(old);
		... when != btrfs_tree_read_unlock(old);
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-28964')
