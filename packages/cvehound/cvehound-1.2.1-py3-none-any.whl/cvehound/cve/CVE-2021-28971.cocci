/// Files: arch/x86/events/intel/ds.c
/// Fix: d88d05a9e0b6d9356e97129d4ff9942d765f46ea
/// Fixes: 01330d7288e0050c5aaabc558059ff91589e67cd

virtual detect

@err exists@
identifier pebs_status, cpuc;
position p;
@@

intel_pmu_drain_pebs_nhm(...)
{
	...
*	if (!pebs_status && cpuc->pebs_enabled &&
* 	    !(cpuc->pebs_enabled & (cpuc->pebs_enabled-1)))
*			pebs_status =@p cpuc->pebs_enabled;
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-28971')
