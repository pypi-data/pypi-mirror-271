/// Files: net/qrtr/qrtr.c include/uapi/linux/qrtr.h
/// Fix: 50535249f624d0072cd885bcdce4e4b6fb770160
/// Fixes: bdabad3e363d825ddf9679dd431cca0b2c30f881

virtual detect

@hole@
symbol sq_family, sq_node;
typedef __u32, __kernel_sa_family_t;
@@
struct sockaddr_qrtr {
*	__kernel_sa_family_t sq_family;
*	__u32 sq_node;
	...
};

@err depends on hole exists@
identifier addr;
position p;
@@

qrtr_recvmsg(...)
{
	...
	if (addr) {
		... when != memset(addr, 0, sizeof(*addr));
*		addr->sq_family =@p AF_QIPCRTR;
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-29647')
