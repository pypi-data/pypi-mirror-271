/// Files: net/bluetooth/hci_request.c net/bluetooth/hci_core.c
/// Fix: e2cb6b891ad2b8caa9131e3be70f45243df82a80
/// Fixes: 7c6a329e444725f24c02192ac493d8a7cd9fa638

virtual detect

@err@
identifier hdev, ret;
position p;
@@

\(hci_req_sync\|hci_request\)(struct hci_dev *hdev,...)
{
	...
*	if (!test_bit@p(HCI_UP, &hdev->flags))
*		return -ENETDOWN;
*	\(hci_req_sync_lock\|hci_req_lock\)(hdev);
*	ret = \(__hci_req_sync\|__hci_request\)(hdev, ...);
*	\(hci_req_sync_unlock\|hci_req_unlock\)(hdev);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-32399')
