/// Files: kernel/bpf/hashtab.c
/// Fix: c4eb1f403243fc7bbb7de644db8587c03de36da6
/// Fixes: 057996380a42bb64ccc04383cfa9c0ace4ea11f0

virtual detect

@err exists@
identifier keys, values, key_size, value_size, bucket_size;
position p;
@@

__htab_map_lookup_and_delete_batch(...)
{
	...
*	keys =@p kvmalloc(key_size * bucket_size, ...);
*	values = kvmalloc(value_size * bucket_size, ...);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-38166')
