/// Files: lib/iov_iter.c
/// Fix: 9d2231c5d74e13b2a0546fee6737ee4446017903
/// Fixes: 241699cd72a8489c9446ae3910ddd243e9b9061b

virtual detect

@err_copy_page_to_iter_pipe@
identifier buf;
symbol page_cache_pipe_buf_ops;
position p;
@@

copy_page_to_iter_pipe(...)
{
	...
*	buf->ops =@p &page_cache_pipe_buf_ops;
	... when != buf->flags = 0;
}

@err_push_pipe exists@
expression E;
symbol default_pipe_buf_ops;
position p;
@@

push_pipe(...)
{
	...
*	\(E.ops\|E->ops\) =@p &default_pipe_buf_ops;
	... when != \(E.flags\|E->flags\) = 0;
}

@script:python depends on detect@
p << err_copy_page_to_iter_pipe.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-0847')

@script:python depends on detect@
p << err_push_pipe.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-0847')
