/// Files: fs/fuse/dev.c
/// Fix: 0c4bcfdecb1ac0967619ee7ff44871d93c08c909
/// Fixes: c3021629a0d820247ee12b6c5192a1d5380e21c6

virtual detect

@err@
identifier cs, page, offset, count;
position p;
statement S;
@@

fuse_copy_page(struct fuse_copy_state *cs, ...,
	       unsigned offset, unsigned count, ...)
{
	...
	while (count) {
*		if (cs->write && cs->pipebufs && page) {
*			return fuse_ref_page@p(cs, page, offset, count);
		} else if (!cs->len)
			S
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-1011')
