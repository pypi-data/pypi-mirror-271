/// Files: drivers/block/floppy.c
/// Fix: f71f01394f742fc4558b3f9f4c7ef4c4cf3b07c8
/// Detect-To: v2.6.12-rc2

virtual detect

@global_errors@
identifier errors;
@@

* static int *errors;

@global_current_req@
identifier current_req;
@@

* static struct request *current_req;

@errors_redo_fd_request@
identifier global_errors.errors, global_current_req.current_req;
@@

redo_fd_request(void)
{
	...
*	errors = &(current_req->\(error_count\|errors\));
	...
}

@err_bad_flp_intr depends on errors_redo_fd_request@
identifier err_count, global_errors.errors;
position p;
@@

bad_flp_intr(...)
{
	...
*	err_count =@p ++(*errors);
	...
}

@script:python depends on detect@
p << err_bad_flp_intr.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-1652')
