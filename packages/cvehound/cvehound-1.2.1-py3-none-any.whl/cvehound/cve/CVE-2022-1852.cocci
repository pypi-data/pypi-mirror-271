/// Files: arch/x86/kvm/x86.c
/// Fix: fee060cd52d69c114b62d1a2948ea9648b5131f9
/// Fixes: 4aa2691dcbd38ce1c461188799d863398dd2865d
/// Version: 1.0.7

virtual detect

@err@
identifier vcpu, emulation_type, insn, insn_len, r;
position p;
@@

x86_decode_emulated_instruction(struct kvm_vcpu *vcpu, int emulation_type,
				void *insn, int insn_len)
{
	...
	int r = EMULATION_OK;
	...
	init_emulate_ctxt(vcpu);
	...
*	if (!(emulation_type & EMULTYPE_SKIP) &&
*	    kvm_vcpu_check_breakpoint(vcpu, &r))
*		return r;@p
	...
	r = x86_decode_insn(..., insn, insn_len, ...);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-1852')
