/// Files: drivers/android/binder.c
/// Fix: a0e44c64b6061dda7e00b7c458e4523e2331b739
/// Detect-To: 372e3147df7016ebeaa372939e8774a1292db558

virtual detect

@err@
identifier proc, rdata, ref, new_ref, ret;
position p;
@@

binder_inc_ref_for_node(struct binder_proc *proc, ...,
			struct binder_ref_data *rdata)
{
	...
*	ret = \(binder_inc_ref\|binder_inc_ref_olocked\)(ref, ...);
*	*rdata =@p ref->data;
(
	binder_proc_unlock(proc);
|
)
	if (new_ref && ref != new_ref)
		kfree(new_ref);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-20421')
