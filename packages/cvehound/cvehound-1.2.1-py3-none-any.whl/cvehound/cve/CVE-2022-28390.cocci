/// Files: drivers/net/can/usb/ems_usb.c
/// Fix: c70222752228a62135cee3409dccefd494a24646
/// Fixes: 702171adeed3607ee9603ec30ce081411e36ae42

virtual detect

@err@
identifier skb, netdev, err;
position p;
statement S;
@@

ems_usb_start_xmit(struct sk_buff *skb, struct net_device *netdev)
{
	...
*	can_put_echo_skb(skb, netdev, ...);
	...
*	err = usb_submit_urb(...);
	if (unlikely(err)) {
		...
		can_free_echo_skb(netdev, ...);
		...
*		dev_kfree_skb@p(skb);
		...
	} else S
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-28390')
