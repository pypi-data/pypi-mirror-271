/// Files: kernel/bpf/verifier.c
/// Fix: a657182a5c5150cdfacb6640aad1d2712571a409
/// Fixes: d2e4c1e6c2947269346054ac8937ccfe9e0bcc6b

virtual detect

@err@
identifier range, env, meta, map, reg;
position p;
statement S;
@@

record_func_key(struct bpf_verifier_env *env,
		struct bpf_call_arg_meta *meta, ...)
{
	...
*	range = tnum_range@p(0, map->max_entries - 1);
	...
*	if (... || !tnum_in(range, reg->var_off))
		S
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-2905')
