/// Files: fs/namespace.c
/// Fix: a1480dcc3c706e309a88884723446f2e84fedd5b
/// Detect-To: v2.6.12-rc2

virtual detect

@err@
identifier flags, mnt;
symbol current;
position p;
@@

do_umount(...)
{
	...
	if (... && !(flags & MNT_DETACH)) {
		... when != if (!\(ns_capable\|capable\)(..., CAP_SYS_ADMIN)) return -EPERM;
*		do_remount_sb@p(sb, MS_RDONLY, ...)
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2014-7975')
