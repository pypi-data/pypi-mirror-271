/// Files: arch/powerpc/kernel/process.c
/// Fix: 8e96a87c5431c256feb65bcfc5aec92d9f7839b6
/// Fixes: bc2a9408fa65195288b41751016c36fd00a75a85

virtual detect

@fix exists@
@@

start_thread(...)
{
	...
	if (MSR_TM_SUSPENDED(mfmsr()))
		tm_reclaim_current(0);
	...
}

@err depends on !fix exists@
identifier regs;
position p;
@@

start_thread(struct pt_regs *regs, ...)
{
	...
*	regs->msr |=@p MSR_TM;
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2016-5828')
