/// Files: arch/powerpc/kvm/powerpc.c
/// Fix: ac64115a66c18c01745bbd3c47a36b124e5fd8c0
/// Fixes: 23528bb21ee2c9b27f3feddd77a2a3351a8df148

virtual detect

@err exists@
identifier kvm;
position p;
@@

kvm_vm_ioctl_check_extension(struct kvm *kvm, ...)
{
	...
	switch (ext) {
	case KVM_CAP_PPC_HTM:
		...
		cpu_has_feature(CPU_FTR_TM_COMP) && is_kvmppc_hv_enabled@p(kvm)
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2017-15306')
