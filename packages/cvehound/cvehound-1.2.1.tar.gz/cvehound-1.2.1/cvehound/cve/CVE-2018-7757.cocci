/// Files: drivers/scsi/libsas/sas_expander.c
/// Fix: 4a491b1ab11ca0556d2fda1ff1301e862a2d44c4
/// Fixes: 2908d778ab3e244900c310974e1fc1c69066e450

virtual detect

@err@
identifier req, resp, res, out;
position p;
type T1, T2;
@@

sas_smp_get_phy_events(...)
{
	...
(
*	T1 *req = alloc_smp_req(RPEL_REQ_SIZE);
|
*	req = alloc_smp_req(RPEL_REQ_SIZE);
)
	...
(
	T2 *resp = \(alloc_smp_resp\|kzalloc\)(RPEL_RESP_SIZE, ...);
|
	resp = \(alloc_smp_resp\|kzalloc\)(RPEL_RESP_SIZE, ...);
)
	...
	res = smp_execute_task(...);
	if (!res)
*		goto out;
	...
out:
	... when != kfree(req);
*	kfree@p(resp);
	return res;
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2018-7757')
