/// Files: net/netlink/genetlink.c
/// Fix: ceabee6c59943bdd5e1da1a6a20dc7ee5f8113a2
/// Fixes: 2ae0f17df1cd52aafd1ab0415ea1f1dd56dc0e2a

virtual detect

@err exists@
identifier family, errout_locked;
position p;
@@

genl_register_family(struct genl_family *family)
{
	...
*	family->attrbuf = \(kmalloc_array\|kmalloc\)(...);
	...
*	family->id = idr_alloc(..., family, ...);
	if (\(family->id < 0\|!family->id\)) {
		...
*		goto errout_locked;@p
	}
	...
errout_locked:
	... when != kfree(family->attrbuf);
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-15921')
