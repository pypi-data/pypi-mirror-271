/// Files: drivers/gpu/drm/v3d/v3d_gem.c
/// Fix: 29cd13cfd7624726d9e6becbae9aa419ef35af7f
/// Fixes: a783a09ee76d6259296dc6aeea2b6884fa526980

virtual detect

@err_render_base@
identifier args, render, bin;
position p;
@@

v3d_submit_cl_ioctl(...)
{
	...
	v3d_job_init(..., &render->base, ...)
	...
	if (args->bcl_start != args->bcl_end) {
*		bin = kcalloc(...);
*		if (!bin)
*			return -ENOMEM;@p
		...
	}
	...
}

@err_bin@
identifier args, bin, ret;
position p;
@@

v3d_submit_cl_ioctl(...)
{
	...
	if (args->bcl_start != args->bcl_end) {
*		bin = kcalloc(...);
		...
*		ret = v3d_job_init(..., &bin->base, ...);
		if (ret) {
			... when != kfree(bin);
*			return ret;@p
		}
		...
	}
	...
}


@script:python depends on detect@
p << err_render_base.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-19044')

@script:python depends on detect@
p << err_bin.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-19044')
