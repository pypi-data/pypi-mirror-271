/// Files: arch/x86/kvm/cpuid.c
/// Fix: 433f4ba1904100da65a311033f17a9bf586b287e
/// Fixes: 84cffe499b9418d6c3b4de2ad9599cc2ec50c607

virtual detect

@noop exists@
@@

\(__do_cpuid_func_emulated\|__do_cpuid_ent_emulated\)(...)
{
	return 0;
}

@err depends on !noop exists@
identifier nent;
symbol maxnent;
position p;
@@

\(do_cpuid_func\|do_cpuid_ent\)(..., int *nent, ...)
{
	... when != if (*nent >= maxnent) return ...;
	    when any
*	\(__do_cpuid_func_emulated@p\|__do_cpuid_ent_emulated@p\)(...)
	... when any
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-19332')
