/// Files: mm/mremap.c include/asm-generic/pgtable.h include/linux/mm.h
/// Fix: 5bfea2d9b17f1034a68147a8b03b9789af5700f9
/// Fixes: 5c7fb56e5e3f7035dd798a8e1adee639f87043e5

virtual detect

@pmd_devmap exists@
@@

* pmd_devmap(...)
{
	...
}


@err depends on pmd_devmap exists@
identifier old_pmd;
statement S1, S2;
position p;
@@

move_page_tables(...)
{
	... when any
(
*	if (is_swap_pmd(*old_pmd) ||@p pmd_trans_huge(*old_pmd))
		S1
	else
		S2
|
*	if (pmd_trans_huge(*old_pmd)@p)
		S1
)
	... when any
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2020-10757')
