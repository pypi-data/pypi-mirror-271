/// Files: net/xfrm/xfrm_policy.c
/// Fix: 4c59406ed00379c8663f8663d82b2537467ce9d7
/// Fixes: ea2dea9dacc256fe927857feb423872051642ae7

virtual detect

@err@
identifier policy;
position p;
@@

xfrm_policy_kill(struct xfrm_policy *policy)
{
	... when != write_lock_bh(&policy->lock);
* 	policy->walk.dead =@p 1;
	... when != write_unlock_bh(&policy->lock);
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2020-27066')
