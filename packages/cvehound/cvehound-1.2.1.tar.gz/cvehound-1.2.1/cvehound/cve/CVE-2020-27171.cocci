/// Files: kernel/bpf/verifier.c
/// Fix: 10d2bb2e6b1d8c4576c56a748f697dbeb8388899
/// Fixes: 979d63d50c0c0f7bc537bf821e056cc9fe5abd38

virtual detect

@err exists@
identifier mask_to_left;
position p;
@@

retrieve_ptr_limit(...)
{
	...
(
	if (mask_to_left)
*		*ptr_limit =@p MAX_BPF_STACK + off;
	else
		*ptr_limit = -off;
|
	 if (mask_to_left) {
*		*ptr_limit =@p ptr_reg->umax_value + ptr_reg->off;
 	} else {
		off = ptr_reg->smin_value + ptr_reg->off;
		*ptr_limit = ptr_reg->map_ptr->value_size - off;
	}
)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2020-27171')
