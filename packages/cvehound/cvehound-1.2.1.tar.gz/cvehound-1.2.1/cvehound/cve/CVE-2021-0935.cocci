/// Files: net/ipv6/datagram.c
/// Fix: 2f987a76a97773beafbc615b9c4d8fe79129a7f4
/// Fixes: 85cb73ff9b74785a7fc752875d7f0fe17ca3ea7c

virtual detect

@err@
identifier sk, inet;
position p;
@@

__ip6_datagram_connect(struct sock *sk, ...)
{
	...
*	err = ip6_datagram_dst_update(sk, true);
	if (err) {
*		memset@p(&sk->sk_v6_daddr, 0, sizeof(sk->sk_v6_daddr));
*		inet->inet_dport = 0;
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-0935')
