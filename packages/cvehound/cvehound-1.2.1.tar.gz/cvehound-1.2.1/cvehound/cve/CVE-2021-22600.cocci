/// Files: net/packet/af_packet.c
/// Fix: ec6af094ea28f0f2dda1a6a33b14cd57e36a9755
/// Fixes: 61fad6816fc10fb8793a925d5c1256d1c3db0cd2
/// Version: 1.1.0

virtual detect

@err@
identifier rx_owner_map, pg_vec, out_free_pg_vec;
position p;
@@

packet_set_ring(...)
{
	...
out_free_pg_vec:
*	bitmap_free@p(rx_owner_map);
*	if (pg_vec)
*		free_pg_vec(pg_vec, ...);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-22600')
