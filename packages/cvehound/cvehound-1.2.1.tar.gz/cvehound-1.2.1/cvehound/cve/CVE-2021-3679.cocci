/// Files: kernel/trace/ring_buffer.c
/// Fix: 67f0d6d9883c13174669f88adac4f0ee656cc16a
/// Fixes: bf41a158cacba6ca5fc6407a54e7ad8ce1567e2e

virtual detect

@err exists@
identifier reader, commit, head;
position p;
@@

rb_per_cpu_empty(...)
{
	...
*	return reader->read ==@p rb_page_commit(reader) &&
*		(commit == reader ||
*		 (commit == head &&
*		  head->read == rb_page_commit(commit)));
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-3679')
