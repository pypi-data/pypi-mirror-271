/// Files: fs/btrfs/volumes.c
/// Fix: e4571b8c5e9ffa1e85c0c671995bd4dcc5c75091
/// Fixes: a27a94c2b0c727517c17cf2ca3a9f7291caadfbc

virtual detect

@err exists@
identifier fs_info, device_path, devid, device;
statement S1, S2;
position p;
@@

btrfs_rm_device(struct btrfs_fs_info *fs_info, const char *device_path, u64 devid)
{
	...
*	device = btrfs_find_device_by_devspec(fs_info, devid, device_path);
	if (IS_ERR(device)) {
		if (PTR_ERR(device) == -ENOENT &&
*		    strcmp@p(device_path, "missing") == 0) S1
		else S2
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-3739')
