/// Files: arch/powerpc/kvm/book3s_rtas.c
/// Fix: f62f3c20647ebd5fb6ecb8f0b477b9281c44c10a
/// Fixes: 8e591cb7204739efa8e15967ea334eb367039dde

virtual detect

@err exists@
symbol args, orig_rets;
position p;
@@

kvmppc_rtas_hcall(...)
{
	...
*	orig_rets = args.rets;
	... when != \(be32_to_cpu(args.nargs)\|args.nargs\) >= ARRAY_SIZE(args.args)
(
*	args.args@p[be32_to_cpu(args.nargs)]
|
*	args.args@p[args.nargs]
)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-37576')
