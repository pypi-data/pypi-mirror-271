/// Files: fs/ext4/inline.c
/// Fix: a54c4613dac1500b40e4ab55199f7c51f028e848
/// Fixes: f19d5870cbf72d4cb2a8e1f749dff97af99b071e

virtual detect

@err exists@
identifier inode;
position p;
@@

ext4_write_inline_data_end(struct inode *inode, ...)
{
	...
(
*	down_write(&EXT4_I(inode)->xattr_sem);
|
*	ext4_write_lock_xattr(inode, ...);
)
	... when != ext4_find_inline_data_nolock(inode)
*	kmap_atomic@p(page)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-40490')
