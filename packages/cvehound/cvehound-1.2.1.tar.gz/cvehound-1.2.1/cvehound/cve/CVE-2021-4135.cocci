/// Files: drivers/net/netdevsim/bpf.c
/// Fix: 481221775d53d6215a6e5e9ce1cce6d2b4ab9a46
/// Fixes: 395cacb5f1a0a290f1ae9ca4692c400d2b57a705
/// Version: 1.1.0

virtual detect

@err exists@
identifier offmap, nmap, i, err, key;
position p;
@@

nsim_bpf_map_alloc(..., struct bpf_offloaded_map *offmap)
{
	...
	for (...; i < ARRAY_SIZE(nmap->entry); ...) {
		...
		err = nsim_map_alloc_elem(offmap, i);
		...
*		key = nmap->entry[i].key;
*		*key =@p i;
		... when != memset(nmap->entry[i].value, 0, offmap->map.value_size);
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-4135')
