/// Files: kernel/bpf/verifier.c
/// Fix: 3cf2b61eb06765e27fec6799292d9fb46d0b7e60
/// Fixes: 3f50f132d8400e129fc9eb68b5020167ef80a244

virtual detect

@err exists@
identifier insn, dst_reg;
position p;
@@

check_alu_op(..., struct bpf_insn *insn)
{
	...
	if (BPF_CLASS(insn->code) == BPF_ALU64) {
		...
	} else {
		...
*		zext_32_to_64@p(dst_reg);
		... when != __update_reg_bounds(dst_reg); __reg_deduce_bounds(dst_reg); __reg_bound_offset(dst_reg);
		    when != reg_bounds_sync(dst_reg);
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-45402')
