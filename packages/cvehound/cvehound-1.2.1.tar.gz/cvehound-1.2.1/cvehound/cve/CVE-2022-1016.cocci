/// Files: net/netfilter/nf_tables_core.c
/// Fix: 4c905f6740a365464e91467aa50916555b28213d
/// Fixes: 96518518cc417bb0a8c80b9fb736202e28acdf96

virtual detect

@fix@
identifier regs;
@@

\(nft_do_chain\|nft_do_chain_pktinfo\)(...)
{
	...
(
*	struct nft_regs regs = {};
|
*	struct nft_data regs[NFT_REG_MAX + 1] = {};
)
	...
}

@err depends on !fix exists@
identifier regs, expr;
iterator name nft_rule_for_each_expr, list_for_each_entry_continue_rcu;
position p;
@@

\(nft_do_chain\|nft_do_chain_pktinfo\)(...)
{
	...
(
*	struct nft_regs regs;@p
|
*	struct nft_data regs[NFT_REG_MAX + 1];@p
)
	... when != memset(&regs, 0, ...);
(
*	\(nft_cmp_fast_eval\|nft_bitwise_fast_eval\|nft_payload_fast_eval\|expr_call_ops_eval\|expr->ops->eval\)(..., &regs, ...)
|
*	expr->ops->eval(..., regs, ...)
)
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-1016')
