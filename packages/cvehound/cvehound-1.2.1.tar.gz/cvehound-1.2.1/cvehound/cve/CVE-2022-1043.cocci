/// Files: fs/io_uring.c
/// Fix: a30f895ad3239f45012e860d4f94c1a388b36d14
/// Fixes: 61cf93700fe6359552848ed5e3becba6cd760efa

virtual detect

@err@
identifier ret, id, ctx, creds;
position p;
@@

io_register_personality(struct io_ring_ctx *ctx)
{
	...
	creds = get_current_cred();
*	ret = xa_alloc_cyclic(&ctx->personalities, &id, (void *)creds, ..., &ctx->pers_next, GFP_KERNEL);
*	if (!ret)
*		return id;
*	put_cred@p(creds);
	return ret;
}


@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-1043')
