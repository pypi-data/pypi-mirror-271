/// Files: net/llc/af_llc.c
/// Fix: 764f4eb6846f5475f1244767d24d25dd86528a4a
/// Fixes: v2.6.12-rc2

virtual detect

@fix_llc_ui_autobind@
identifier out, llc, rc, dev;
@@

llc_ui_autobind(...)
{
	...
	llc->dev = ...;
	... when any
out:
	...
	\(dev_put_track\|dev_put\)(\(llc->dev\|dev\), ...);
	...
	return rc;
}

@err_llc_ui_autobind depends on !fix_llc_ui_autobind@
identifier out;
position p;
@@

llc_ui_autobind(...)
{
	...
out:@p
	...
*	return ...;
}

@fix_llc_ui_bind@
identifier out, llc, rc, dev;
@@

llc_ui_bind(...)
{
	...
	llc->dev = ...;
	... when any
out:
	...
	\(dev_put_track\|dev_put\)(\(llc->dev\|dev\), ...);
	...
	return rc;
}

@err_llc_ui_bind depends on !fix_llc_ui_bind@
identifier out;
position p;
@@

llc_ui_bind(...)
{
	...
out:@p
	...
*	return ...;
}

@script:python depends on detect@
p << err_llc_ui_autobind.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-28356')

@script:python depends on detect@
p << err_llc_ui_bind.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-28356')
