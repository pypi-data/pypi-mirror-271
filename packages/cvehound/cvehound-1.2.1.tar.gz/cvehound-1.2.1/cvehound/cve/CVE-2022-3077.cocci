/// Files: drivers/i2c/busses/i2c-ismt.c
/// Fix: 690b2549b19563ec5ad53e5c82f6a944d910086e
/// Fixes: 5e9a97b1f4491b8b65874901ad084348fcaba327
/// Version: 1.1.0

virtual detect

@err@
identifier size, data, dma_size;
position p;
@@

ismt_access(..., int size, union i2c_smbus_data *data)
{
	...
	switch (size) {
	case I2C_SMBUS_BLOCK_PROC_CALL:
		dev_dbg(..., "I2C_SMBUS_BLOCK_PROC_CALL\n");
		... when != if (data->block[0] > I2C_SMBUS_BLOCK_MAX) return -EINVAL;
*		dma_size =@p I2C_SMBUS_BLOCK_MAX;
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-3077')
