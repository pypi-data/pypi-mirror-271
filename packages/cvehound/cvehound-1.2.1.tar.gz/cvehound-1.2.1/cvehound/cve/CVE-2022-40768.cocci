/// Files: drivers/scsi/stex.c
/// Fix: 6022f210461fef67e6e676fd8544ca02d1bcfa7a
/// Detect-To: 5a25ba1677ab8d63890016a8c1bca68a3e0fbc7d

virtual detect

@err disable decl_init@
identifier cmd, ver;
position p;
@@

\(stex_queuecommand\|stex_queuecommand_lck\)(struct scsi_cmnd *cmd, ...)
{
	...
	if (cmd->cmnd[1] == PASSTHRU_GET_DRVVER) {
*		struct st_drvver ver;@p
		...
(
*		scsi_sg_copy_from_buffer(cmd, &ver, ...)
|
*		stex_direct_copy(cmd, &ver, ...)
|
*		stex_internal_copy(cmd, &ver, ...)
)
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-40768')
