/// Files: drivers/spi/spi-fsl-lpspi.c
/// Fix: 057b8945f78f76d0b04eeb5c27cd9225e5e7ad86
/// Fixes: 944c01a889d97dc08e1b71f4ed868f4023fd6034
/// Version: 1.1.0

virtual detect

@err exists@
identifier ret, controller, out_controller_put;
position p;
@@

fsl_lpspi_probe(...)
{
	...
*	controller = spi_alloc_slave(...);
	...
*	ret = pm_runtime_get_sync(...);
	if (ret < 0) {
		... when != spi_controller_put(controller);
*		return ret;@p
	}
	...
out_controller_put:
*	spi_controller_put(controller);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-19064')
