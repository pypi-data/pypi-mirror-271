/// Files: drivers/spi/spi-gpio.c
/// Fix: d3b0ffa1d75d5305ebe34735598993afbb8a869d
/// Fixes: 8b797490b4db09492acda4b4a4a4355d2311a614

virtual detect

@err@
identifier pdev, master, status;
symbol spi_gpio_put;
position p;
@@

spi_gpio_probe(struct platform_device *pdev)
{
	...
*	master = spi_alloc_master(...);
	...
*	status = devm_add_action_or_reset(&pdev->dev, spi_gpio_put, master);
*	if (status)
*		return status;@p
	... when any
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2019-19070')
