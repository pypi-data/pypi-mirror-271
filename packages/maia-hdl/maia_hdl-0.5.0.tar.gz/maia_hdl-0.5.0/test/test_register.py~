#!/usr/bin/env python3

from amaranth import *

import unittest

from maia_hdl.register import Register, Field, Access
from .amaranth_sim import AmaranthSim


class TestRegister(AmaranthSim):
    def setUp(self):
        self.dut = m = Module()
        self.register = Register(
            'dut_register',
            [Field(Access.RW, 'rw_field', 7, 42),
             Field(Access.R, 'r_field', 5, 0),
             Field(Access.W, 'w_field', 12, 1873)])
        self.readable = Signal(5)
        m.submodules.register = self.register
        m.submodules.readable = self.readable
        m.d.comb += self.register['r_field'].eq(self.readable)

    def test_initial_value(self):
        def bench():
            yield self.
