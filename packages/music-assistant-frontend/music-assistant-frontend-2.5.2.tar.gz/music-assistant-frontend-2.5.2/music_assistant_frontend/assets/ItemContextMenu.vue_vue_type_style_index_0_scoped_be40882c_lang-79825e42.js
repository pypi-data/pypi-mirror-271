import{d as M,r as c,o as x,at as L,a as C,c as _,e as T,w as b,f as m,g as v,h as k,F as V,u as g,$ as A,s as w,ay as y,M as t,b as r,C as u,P as h}from"./index-1fa25223.js";import{e as f}from"./eventbus-d154090d.js";import{b as p}from"./helpers-f9fbf435.js";import{a as F}from"./VList-f519ecda.js";import{V as P}from"./VCard-99bbc2f5.js";import{V as R}from"./VMenu-85495654.js";import{V as S}from"./VListItem-53d44b85.js";const O=async function(a,o,i=0,e=0,l=!0){const s=Array.isArray(a)?a:[a];if(s.length==0)return;const d=[];l&&d.push(...B(s,o)),d.push(...E(s,o)),f.emit("contextmenu",{items:d,posX:i,posY:e})},B=function(a,o){const i=[];if(a.length==0||!p(a[0]))return i;let e=y.NEXT;return(a.length>10||[t.ALBUM,t.PLAYLIST].includes(a[0].media_type))&&(e=y.REPLACE_NEXT),a.length==1&&o&&o.uri!=a[0].uri&&(o.media_type==t.PLAYLIST&&i.push({label:"play_playlist_from",action:()=>{r.playMedia(o.uri,void 0,!1,a[0].item_id)},icon:"mdi-play-circle-outline",labelArgs:[]}),o.media_type==t.ALBUM&&i.push({label:"play_album_from",action:()=>{r.playMedia(o.uri,void 0,!1,a[0].item_id)},icon:"mdi-play-circle-outline",labelArgs:[]})),i.push({label:"play_now",action:()=>{r.playMedia(a.map(l=>l.uri),void 0)},icon:"mdi-play-circle-outline",labelArgs:[]}),K(a[0])&&i.push({label:"play_radio",action:()=>{r.playMedia(a.map(l=>l.uri),void 0,!0)},icon:"mdi-radio-tower",labelArgs:[]}),(a.length===1||a[0].media_type===t.TRACK)&&i.push({label:"play_next",action:()=>{r.playMedia(a.map(l=>l.uri),e)},icon:"mdi-skip-next-circle-outline",labelArgs:[]}),i.push({label:"add_queue",action:()=>{r.playMedia(a.map(l=>l.uri),y.ADD)},icon:"mdi-playlist-plus",labelArgs:[]}),i},E=function(a,o){const i=[];if(a.length==0)return i;if(a.length===1&&a[0]!==o&&p(a[0])&&i.push({label:"show_info",labelArgs:[],action:()=>{var e;u.push({name:a[0].media_type,params:{itemId:a[0].item_id,provider:a[0].provider},query:{album:"album"in a[0]?(e=a[0].album)==null?void 0:e.uri:""}})},icon:"mdi-information-outline"}),a.length===1&&p(a[0])&&"artists"in a[0]&&a[0].artists.length===1)for(const e of a[0].artists)i.push({label:"goto_artist",labelArgs:[e.name],action:()=>{u.push({name:"artist",params:{itemId:e.item_id,provider:e.provider}})},icon:"mdi-account-music"});if(a.length===1&&p(a[0])&&"album"in a[0]&&a[0].album&&i.push({label:"goto_album",labelArgs:[a[0].album.name],action:()=>{u.push({name:"album",params:{itemId:a[0].album.item_id,provider:a[0].album.provider}})},icon:"mdi-album"}),a.length===1&&(a[0]==o||!p(a[0]))&&i.push({label:"refresh_item",labelArgs:[],action:async()=>{await r.refreshItem(a[0]),u.go(0)},icon:"mdi-refresh"}),a[0].provider!="library"&&p(a[0])&&i.push({label:"add_library",labelArgs:[],action:()=>{for(const e of a)r.addItemToLibrary(e)},icon:"mdi-bookshelf"}),a[0].provider=="library"&&i.push({label:"remove_library",labelArgs:[],action:()=>{if(confirm(A("confirm_library_remove"))){for(const e of a)r.removeItemFromLibrary(e.media_type,e.item_id);a[0].item_id==(o==null?void 0:o.item_id)?u.go(-1):u.go(0)}},icon:"mdi-bookshelf"}),"favorite"in a[0]&&!a[0].favorite&&i.push({label:"favorites_add",labelArgs:[],action:()=>{for(const e of a)r.addItemToFavorites(e)},icon:"mdi-heart-outline"}),"favorite"in a[0]&&a[0].favorite&&i.push({label:"favorites_remove",labelArgs:[],action:()=>{for(const e of a)r.removeItemFromFavorites(e.media_type,e.item_id),e.favorite=!1},icon:"mdi-heart"}),o&&o.media_type===t.PLAYLIST){const e=o;a[0].media_type===t.TRACK&&e.is_editable&&i.push({label:"remove_playlist",labelArgs:[],action:()=>{r.removePlaylistTracks(e.item_id,a.map(l=>l.position))},icon:"mdi-minus-circle-outline"})}return(a[0].media_type===t.TRACK||a[0].media_type===t.ALBUM)&&"provider_mappings"in a[0]&&i.push({label:"add_playlist",labelArgs:[],action:()=>{f.emit("playlistdialog",{items:a,parentItem:o})},icon:"mdi-plus-circle-outline"}),i},K=function(a){var o,i;if("provider_mappings"in a){for(const e of a.provider_mappings)if((o=r.providers[e.provider_instance])!=null&&o.supported_features.includes(h.SIMILAR_TRACKS))return!0}else if((i=r.providers[a.provider])!=null&&i.supported_features.includes(h.SIMILAR_TRACKS))return!0;return!1},$=M({__name:"ItemContextMenu",setup(a){const o=c(!1),i=c([]),e=c(0),l=c(0);return x(()=>{f.on("contextmenu",async s=>{i.value=s.items,e.value=s.posX||0,l.value=s.posY||0,L(()=>{o.value=!0})}),C(()=>{f.off("contextmenu")})}),(s,d)=>(_(),T(R,{modelValue:o.value,"onUpdate:modelValue":[d[0]||(d[0]=n=>o.value=n),d[1]||(d[1]=n=>{g(w).dialogActive=n})],target:[e.value,l.value],scrim:""},{default:b(()=>[m(P,{"min-width":"260"},{default:b(()=>[m(F,{density:"compact",slim:"",tile:""},{default:b(()=>[(_(!0),v(V,null,k(i.value,n=>(_(),v("div",{key:n.label,class:"menurow"},[m(S,{variant:"text",title:g(A)(n.label,n.labelArgs||[]),disabled:n.disabled==!0,"prepend-icon":n.icon,"append-icon":n.selected?"mdi-check":void 0,onClick:()=>n.action?n.action():""},null,8,["title","disabled","prepend-icon","append-icon","onClick"])]))),128))]),_:1})]),_:1})]),_:1},8,["modelValue","target"]))}});export{$ as _,B as a,E as g,O as s};
