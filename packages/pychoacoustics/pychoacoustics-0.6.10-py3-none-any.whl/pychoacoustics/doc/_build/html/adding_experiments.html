<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Writing your own Experiments &mdash; pychoacoustics 0.6.10 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Troubleshooting" href="troubleshooting.html" />
    <link rel="prev" title="The pychoacoustics Engine" href="engine.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pychoacoustics
          </a>
              <div class="version">
                0.6.10
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">What is <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code>?</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="graphical_user_interface.html">Graphical User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="commandline_user_interface.html">Command Line User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="paradigms.html">Paradigms</a></li>
<li class="toctree-l1"><a class="reference internal" href="result_files.html">Result Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="default_experiments.html">Default Experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="engine.html">The <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> Engine</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing your own Experiments</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#first-steps">First Steps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#anatomy-of-a-pychoacoustics-experiment-file">Anatomy of a <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> experiment file</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-initialize-function">The <code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-select-default-parameters-function">The <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-dotrial-function">The <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-support-for-the-constant-paradigm">Adding support for the Constant Paradigm</a></li>
<li class="toctree-l4"><a class="reference internal" href="#showing-hiding-widgets-dynamically">Showing/Hiding Widgets Dynamically</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-constant-1-interval-2-alternatives-paradigm-experiment">Writing a “Constant 1-Interval 2-Alternatives” Paradigm Experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-an-experiment-for-the-transformed-up-down-interleaved-weighted-up-down-interleaved-and-multiple-constants-m-intervals-n-alternatives-paradigms">Writing an experiment for the Transformed Up-Down Interleaved, Weighted Up-Down Interleaved, and Multiple Constants m-Intervals n-Alternatives Paradigms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#writing-a-matching-experiment-using-interleaved-adaptive-tracks">Writing a matching experiment using interleaved adaptive tracks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-constant-1-pair-same-different-paradigm-experiment">Writing a “Constant 1-Pair Same/Different” Paradigm Experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-an-odd-one-out-paradigm-experiment">Writing an “Odd One Out” Paradigm Experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-experiment-opts">The Experiment “opts”</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-play-sound-functions">The Play Sound Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simulations">Simulations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="_autosummary/sndlib.html">sndlib</a></li>
<li class="toctree-l1"><a class="reference internal" href="sndlib.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">sndlib</span></code> – Sound Synthesis Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="_autosummary/pysdt.html">pysdt</a></li>
<li class="toctree-l1"><a class="reference internal" href="pysdt.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pysdt</span></code> – Signal Detection Theory Measures</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="fdl.html">GNU Free Documentation License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pychoacoustics</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Writing your own Experiments</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/adding_experiments.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="writing-your-own-experiments">
<h1>Writing your own Experiments<a class="headerlink" href="#writing-your-own-experiments" title="Permalink to this heading"></a></h1>
<section id="first-steps">
<h2>First Steps<a class="headerlink" href="#first-steps" title="Permalink to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> can be easily extended with new experiments written by users. User-written experiments need to reside in a Python package called <code class="docutils literal notranslate"><span class="pre">labexp</span></code>, and this package needs to be in your Python path. No worries if you’re not familiar with packaging Python software, we’ll go through the process of adding a new experiment step by step.</p>
<p>First of all, you need to create a directory called <code class="docutils literal notranslate"><span class="pre">pychoacoustics_exp</span></code> inside your home directory, and a sub-directory called <code class="docutils literal notranslate"><span class="pre">labexp</span></code> inside the <code class="docutils literal notranslate"><span class="pre">pychoacoustics_exp</span></code> directory. If you don’t know where your home directory is located you can find out from a Python shell with the following commands:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can create the <code class="docutils literal notranslate"><span class="pre">pychoacoustics_exp</span></code> and <code class="docutils literal notranslate"><span class="pre">labexp</span></code> directories from a Python shell as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">dirPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/pychoacoustics_exp/labexp/&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dirPath</span><span class="p">)</span>
</pre></div>
</div>
<p>Each user experiment will be  written in a single file contained in the <code class="docutils literal notranslate"><span class="pre">labexp</span></code> directory. Let’s imagine we want to create an experiment for a frequency discrimination task. We create a file named <code class="docutils literal notranslate"><span class="pre">freq.py</span></code> in the <code class="docutils literal notranslate"><span class="pre">labexp</span></code> directory. In addition to the experiment file we need an additional file that lists all the experiments contained in the <code class="docutils literal notranslate"><span class="pre">labexp</span></code> directory. This file must be named <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>, and in our case it will have the following content:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>here the variable <code class="docutils literal notranslate"><span class="pre">__all__</span></code> is simply a Python list with the
name of the experiment files. So, if one day we decide to write a new
experiment on, let’s say, level discrimination, in a file called
<code class="docutils literal notranslate"><span class="pre">lev.py</span></code> we would simply add it to the list in <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">,</span>
           <span class="s2">&quot;lev&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>For people familiar with packaging Python modules it should be clear
by now that the <code class="docutils literal notranslate"><span class="pre">labexp</span></code> folder is a Python package
containing various modules (the experiment files). If at some point we
want to remove an experiment from <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code>, for example
because it contains a bug that does not allow the program to start, we
can simply remove it from the list in <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>.  Let’s go back
to the <code class="docutils literal notranslate"><span class="pre">freq.py</span></code> file. Here we need to define three functions. For our
example the names of these functions would be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">initialize_freq</span><span class="p">()</span>
<span class="n">select_default_parameters_freq</span><span class="p">()</span>
<span class="n">doTrial_freq</span><span class="p">()</span>
</pre></div>
</div>
<p>basically the function names consist of a fixed prefix, followed by
the name of the experiment file. So, in the case of the level experiment
example, written in the file <code class="docutils literal notranslate"><span class="pre">lev.py</span></code>, the three functions would be
called:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">initialize_lev</span><span class="p">()</span>
<span class="n">select_default_parameters_lev</span><span class="p">()</span>
<span class="n">doTrial_lev</span><span class="p">()</span>
</pre></div>
</div>
<p>we’ll look at each function in detail in the next section. Briefly, the
<code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function is used to set some general parameters and
options for our experiment; the <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function
lists all the widgets (text fields and choosers) of our experiment and
their default values; finally, the <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function contains the code that
generates the sounds and plays them during the experiment.</p>
<section id="anatomy-of-a-pychoacoustics-experiment-file">
<h3>Anatomy of a <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> experiment file<a class="headerlink" href="#anatomy-of-a-pychoacoustics-experiment-file" title="Permalink to this heading"></a></h3>
<section id="the-initialize-function">
<h4>The <code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function<a class="headerlink" href="#the-initialize-function" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function of our frequency discrimination
experiment is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> <span class="k">def</span> <span class="nf">initialize_freq</span><span class="p">(</span><span class="n">prm</span><span class="p">):</span>
<span class="linenos"> 2</span>   <span class="n">exp_name</span> <span class="o">=</span> <span class="s2">&quot;Frequency Discrimination Demo&quot;</span>
<span class="linenos"> 3</span>   <span class="n">prm</span><span class="p">[</span><span class="s2">&quot;experimentsChoices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp_name</span><span class="p">)</span>
<span class="linenos"> 4</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 5</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;paradigmChoices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Transformed Up-Down&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span>                                       <span class="s2">&quot;Weighted Up-Down&quot;</span><span class="p">,</span>
<span class="linenos"> 7</span>                                       <span class="s2">&quot;UML&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span>                                       <span class="s2">&quot;PSI&quot;</span><span class="p">]</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;opts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hasISIBox&quot;</span><span class="p">,</span> <span class="s2">&quot;hasAlternativesChooser&quot;</span><span class="p">,</span>
<span class="linenos">11</span>                            <span class="s2">&quot;hasFeedback&quot;</span><span class="p">]</span>
<span class="linenos">12</span>
<span class="linenos">13</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultAdaptiveType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Geometric&quot;</span>
<span class="linenos">14</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNIntervals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">15</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNAlternatives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">16</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;execString&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;freq&quot;</span>
<span class="linenos">17</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="linenos">18</span>
<span class="linenos">19</span>   <span class="k">return</span> <span class="n">prm</span>
</pre></div>
</div>
<p>When the function is called, it is passed a dictionary containing
various parameters through the <code class="docutils literal notranslate"><span class="pre">prm</span></code> argument. The function modifies
this dictionary by adding the parameters of the experiment, and returns
the dictionary back to the main routine.</p>
<p>Let’s analyze the function for our experiment. On line 2
we give a label to the experiment, this can be anything we
want, except the label of an experiment already existing. On line 3
we add this experiment label to the list of “experimentsChoices”.
On line 4 we create a new sub-dictionary that has as a key the
experiment label. Next we list the paradigms that our experiment
supports by creating a <code class="docutils literal notranslate"><span class="pre">paradigmChoices</span></code> key and giving the names of
the supported paradigms as a list. The paradigms listed here must be
within the set of paradigms  supported by <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> (see
Section <a class="reference internal" href="paradigms.html#sec-paradigms"><span class="std std-ref">Available Paradigms</span></a> for a description of the paradigms currently
supported). In the next line we set an <code class="docutils literal notranslate"><span class="pre">opts</span></code> key containing a list
of options. The full list of options that can be set here is described
in details in Section <a class="reference internal" href="#sec-experiment-opts"><span class="std std-ref">The Experiment “opts”</span></a>. In brief, for our
experiment we want to have a widget to set the silent interval (ISI)
between presentation
intervals (<code class="docutils literal notranslate"><span class="pre">hasISIBox</span></code>), a widget to choose the number of response
alternatives (<code class="docutils literal notranslate"><span class="pre">hasAlternativesChooser</span></code>), and a widget to set the feedback
on or off for a given block of trials (<code class="docutils literal notranslate"><span class="pre">hasFeedback</span></code>).</p>
<p>In the next line we specify <code class="docutils literal notranslate"><span class="pre">defaultAdaptiveType</span></code>, the default type of adaptive
track that will be selected when the experiment is loaded, this could be
either “Geometric”, or “Arithmetic”. Specifying a “defaultAdaptiveType” is
optional. The type of the adaptive procedure can in any case be changed
later by the experimenter in the control window.
In the next two lines we specify the default number of intervals, and the
default number of alternatives that will be used when the experiment is
loaded. Since we have inserted the “hasAlternativesChooser” option, the
number of intervals and alternatives can be later changed by the experimenter
using the appropriate choosers in the control window.
The next line of the <code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function sets the
<code class="docutils literal notranslate"><span class="pre">execString</span></code> of our experiment. This must be the name of our
experiment file, so in our case <code class="docutils literal notranslate"><span class="pre">freq</span></code>.
Finally, we give our experiment a version label. This is optional, but it can
be very useful as this version label will be stored in the result files when
the experiment is run. This makes it possible to track which version of the
experiment was used in a given session.</p>
<p>Before we proceed, a note on the use of a function called <code class="docutils literal notranslate"><span class="pre">QApplication.translate</span></code>
is necessary. You may occasionally see this function in <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> experiment
files and in this manual. This function serves to translate strings from one language
to another. For the moment it doesn’t really do much in <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> because
string translation is not currently functional for the control window, it is only functional for the
response box. This function takes three string arguments, and the text to be translated
is the middle argument. For example, in the <code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function above, we could have
written <code class="docutils literal notranslate"><span class="pre">QApplication.translate(&quot;&quot;,</span> <span class="pre">&quot;Transformed</span> <span class="pre">Up-Down&quot;,</span> <span class="pre">&quot;&quot;)</span></code> instead of <code class="docutils literal notranslate"><span class="pre">Transformed</span> <span class="pre">Up-Down</span></code>.
You don’t need to use this function in your experiments. If you do, you need to import the <code class="docutils literal notranslate"><span class="pre">QApplication</span></code>.
How to do this depends on which version of <code class="docutils literal notranslate"><span class="pre">PyQt</span></code> you’re using, as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="kn">import</span> <span class="n">QApplication</span> <span class="c1">#if you&#39;re using PyQt4</span>
<span class="kn">from</span> <span class="nn">PySide.QtGui</span> <span class="kn">import</span> <span class="n">QApplication</span> <span class="c1">#if you&#39;re using PySide</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QApplication</span> <span class="c1">#if you&#39;re using PyQt5</span>
</pre></div>
</div>
</section>
<section id="the-select-default-parameters-function">
<h4>The <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function<a class="headerlink" href="#the-select-default-parameters-function" title="Permalink to this heading"></a></h4>
<p>All the widgets (text fields and choosers) needed for an experiment are
defined in the <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function. For our frequency
discrimination experiment, the function looks as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> <span class="k">def</span> <span class="nf">select_default_parameters_freq</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">paradigm</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>   <span class="n">field</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 4</span>   <span class="n">fieldLabel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 5</span>   <span class="n">chooser</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 6</span>   <span class="n">chooserLabel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 7</span>   <span class="n">chooserOptions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="linenos">10</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Difference (%)&quot;</span><span class="p">)</span>
<span class="linenos">13</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Level (dB SPL)&quot;</span><span class="p">)</span>
<span class="linenos">16</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Duration (ms)&quot;</span><span class="p">)</span>
<span class="linenos">19</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Ramps (ms)&quot;</span><span class="p">)</span>
<span class="linenos">22</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span>
<span class="linenos">25</span>   <span class="n">chooserOptions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Right&quot;</span><span class="p">,</span>
<span class="linenos">26</span>                          <span class="s2">&quot;Left&quot;</span><span class="p">,</span>
<span class="linenos">27</span>                          <span class="s2">&quot;Both&quot;</span><span class="p">])</span>
<span class="linenos">28</span>   <span class="n">chooserLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Ear:&quot;</span><span class="p">)</span>
<span class="linenos">29</span>   <span class="n">chooser</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Right&quot;</span><span class="p">)</span>
<span class="linenos">30</span>
<span class="linenos">31</span>   <span class="n">prm</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">32</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
<span class="linenos">33</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fieldLabel</span>
<span class="linenos">34</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chooser</span>
<span class="linenos">35</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chooserLabel</span>
<span class="linenos">36</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserOptions&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">chooserOptions</span>
<span class="linenos">37</span>
<span class="linenos">38</span>   <span class="k">return</span> <span class="n">prm</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function accepts three arguments,
“parent” is simply a reference to the pychoacoustics application,
“paradigm” is the paradigm with which the function has been called,
while “par” is a variable that can hold some special values for
initializing the function. The use of the “par” argument will be discussed
later on when procedures with interleaved tracks will be described. For the
time being you should just know that the <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> should
always have this argument.
From line three to line seven, we create a
series of empty lists. The <code class="docutils literal notranslate"><span class="pre">field</span></code> and <code class="docutils literal notranslate"><span class="pre">fieldLabel</span></code> lists will hold
the default values of our text field widgets, and their labels, respectively.
The <code class="docutils literal notranslate"><span class="pre">chooser</span></code> and <code class="docutils literal notranslate"><span class="pre">chooserLabel</span></code> lists will likewise hold the default
values of our chooser widgets, and their labels, while the <code class="docutils literal notranslate"><span class="pre">chooserOptions</span></code>
list will hold  the possible values that our choosers can take.
On lines 9 to 29 we populate these lists for our frequency discrimination experiment.
From line 31 to line 36 we insert in a dictionary the
<code class="docutils literal notranslate"><span class="pre">field</span></code>, <code class="docutils literal notranslate"><span class="pre">fieldLabel</span></code>, <code class="docutils literal notranslate"><span class="pre">chooser</span></code>, <code class="docutils literal notranslate"><span class="pre">chooserLabel</span></code> and <code class="docutils literal notranslate"><span class="pre">chooserOptions</span></code>
lists that we previously creaetd and populated. Finally, on line 38, the function returns
this dictionary.</p>
</section>
<section id="the-dotrial-function">
<h4>The <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function<a class="headerlink" href="#the-dotrial-function" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function is called each time a trial is started, and
is responsible for generating the sounds and presenting them to the
listener. The <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function for our frequency discrimination
experiment is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">doTrial_freq</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>   <span class="n">currBlock</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;currentBlock&#39;</span><span class="p">])</span>
<span class="linenos"> 4</span>    <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;startOfBlock&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 5</span>        <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">]</span> <span class="o">=</span> \
<span class="linenos"> 6</span>          <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Difference (%)&quot;</span><span class="p">)]</span>
<span class="linenos"> 7</span>        <span class="n">parent</span><span class="o">.</span><span class="n">writeResultsHeader</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>    <span class="n">frequency</span> <span class="o">=</span> \
<span class="linenos">10</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">11</span>    <span class="n">level</span> <span class="o">=</span> \
<span class="linenos">12</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Level (dB SPL)&quot;</span><span class="p">)]</span>
<span class="linenos">13</span>    <span class="n">duration</span> <span class="o">=</span> \
<span class="linenos">14</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Duration (ms)&quot;</span><span class="p">)]</span>
<span class="linenos">15</span>    <span class="n">ramps</span> <span class="o">=</span> \
<span class="linenos">16</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Ramps (ms)&quot;</span><span class="p">)]</span>
<span class="linenos">17</span>    <span class="n">channel</span> <span class="o">=</span> \
<span class="linenos">18</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;chooser&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Ear:&quot;</span><span class="p">)]</span>
<span class="linenos">19</span>    <span class="n">phase</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">20</span>
<span class="linenos">21</span>    <span class="n">correctFrequency</span> <span class="o">=</span> <span class="n">frequency</span> <span class="o">+</span> <span class="p">(</span><span class="n">frequency</span><span class="o">*</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">100</span>
<span class="linenos">22</span>    <span class="n">stimulusCorrect</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">correctFrequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span>
<span class="linenos">23</span>                               <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span>
<span class="linenos">24</span>                               <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">25</span>
<span class="linenos">26</span>    <span class="n">stimulusIncorrect</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">27</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;nIntervals&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
<span class="linenos">28</span>        <span class="n">thisSnd</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span>
<span class="linenos">29</span>                           <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">30</span>        <span class="n">stimulusIncorrect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisSnd</span><span class="p">)</span>
<span class="linenos">31</span>
<span class="linenos">32</span>    <span class="n">parent</span><span class="o">.</span><span class="n">playRandomisedIntervals</span><span class="p">(</span><span class="n">stimulusCorrect</span><span class="p">,</span> <span class="n">stimulusIncorrect</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see on the first line, the <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function is passed
as an argument its <code class="docutils literal notranslate"><span class="pre">parent</span></code>. This is important because the parent contains
a dictionary with the parameters for the current experiment (<code class="docutils literal notranslate"><span class="pre">parent.prm</span></code>).
The parameters for each stored block of the experiment are stored
in the <code class="docutils literal notranslate"><span class="pre">parent.prm</span></code> dictionary with keys starting with <code class="docutils literal notranslate"><span class="pre">b</span></code> followed by
the block number. For example <code class="docutils literal notranslate"><span class="pre">parent.prm['b3']</span></code> contains the parameters
for the third stored block. The current block number is stored in
<code class="docutils literal notranslate"><span class="pre">parent.prm['currentBlock']</span></code>, and on line 3 we retrieve the dictionary
key for the current block. On line 4 we start an <code class="docutils literal notranslate"><span class="pre">if</span></code> block that is executed
only at the first trial of each block. In this block we retrieve the % frequency
difference between the standard and the comparison stimuli for the first trial,
and we store it in the <code class="docutils literal notranslate"><span class="pre">parent.prm['adaptiveParam']</span></code> variable.
Since we’re using an adaptive procedure, this variable will be automatically
increased or decreased by <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> on successive trials on the bases
of the responses given by the listener. On line 7 we tell <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code>
to write the header of the ‘log’ result files (see <a class="reference internal" href="result_files.html#sec-log-results-files"><span class="std std-ref">Log Results Files</span></a>).</p>
<p>On lines 9-16 we read off the values of the text field widgets
for the current block of trials. The values of these field widgets
are stored in the list <code class="docutils literal notranslate"><span class="pre">parent.prm[currBlock]['field']</span></code>, and we exploit
the label of each text field widget to retrieve its index in the list.
For example <code class="docutils literal notranslate"><span class="pre">parent.prm['fieldLabel'].index(&quot;Frequency</span> <span class="pre">(Hz)&quot;)</span></code> retrieves
the index of the text widget that stores the frequency of the standard tone
for the current block of trials. On line 18 we read off the value of the only
chooser widget for the current block of trials. The values of chooser widgets
are stored in the list <code class="docutils literal notranslate"><span class="pre">parent.prm[currBlock]['chooser']</span></code>, and we exploit the
label of each chooser widget to retrieve its index in the list as we did for
text field widgets.</p>
<p>Our next step will be to generate the stimuli for the trial.
In a <cite>X</cite>-Intervals task we have to generate <cite>X</cite> stimuli. In our case,
the standard stimuli will have always the same frequency, we retrieved its value
on lines 9-10 of our <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function. If a listener presses the button
corresponding to one of the the standard stimuli his response will be incorrect.
For this reason we will store the standard stimuli in a list
called <code class="docutils literal notranslate"><span class="pre">stimulusIncorrect</span> <span class="pre">=</span> <span class="pre">[]</span></code>. The comparison stimulus will be instead stored
in a variable called <code class="docutils literal notranslate"><span class="pre">stimulusCorrect</span></code>. The frequency of the comparison
stimulus, which can vary from trial to trial, depending on the current value
of <code class="docutils literal notranslate"><span class="pre">parent.prm['adaptiveParam']</span></code> is computed on line 21. On lines 22-24  we
generate the stimulus using the <code class="docutils literal notranslate"><span class="pre">pureTone</span></code> function that is available
in the <code class="docutils literal notranslate"><span class="pre">sndlib</span></code> module. Note that in order to access this function you need
to import it by adding the following line at the top of the <code class="docutils literal notranslate"><span class="pre">freq.py</span></code> file
where the experiment is stored:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pychoacoustics.sndlib</span> <span class="kn">import</span> <span class="n">pureTone</span>
</pre></div>
</div>
<p>Note also that we need to pass the current samplig rate and the current maximum
output level of our headphones (see <a class="reference internal" href="graphical_user_interface.html#sec-edit-phones-dia"><span class="std std-ref">Edit Phones Dialog</span></a>) to
the <code class="docutils literal notranslate"><span class="pre">pureTone</span></code> function. Their values are stored respectively in the
<code class="docutils literal notranslate"><span class="pre">parent.prm['sampRate']</span></code> and <code class="docutils literal notranslate"><span class="pre">parent.prm['maxLevel']</span></code> variables.
On lines 26-30 we generate and store the standard stimuli in the
<code class="docutils literal notranslate"><span class="pre">stimulusIncorrect</span></code> list. The number of standard stimuli to generate will
be equal to the number of intervals minus one. The number of
intervals is stored in the <code class="docutils literal notranslate"><span class="pre">parent.prm['nIntervals']</span></code> variable. Finally on line
32 we call the <code class="docutils literal notranslate"><span class="pre">parent.playRandomisedIntervals</span></code> function to play the stimuli.
This function requires two arguments, the correct stimulus, and a list containing
the incorrect stimuli. That’s it, our frequency discrimination experiment is ready
and we can test it on <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code>.</p>
</section>
<section id="adding-support-for-the-constant-paradigm">
<h4>Adding support for the Constant Paradigm<a class="headerlink" href="#adding-support-for-the-constant-paradigm" title="Permalink to this heading"></a></h4>
<p>So far our frequency discrimination experiment supports only adaptive paradigms.</p>
<p>Adding support for the constant paradigm, in which the frequency difference
between the standard and comparison stimuli is fixed across a block of trials
is easy. All we need to do is add “Constant m-Intervals n-Alternatives” to the
list of paradigms supported paradims in the <code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;paradigmChoices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Transformed Up-Down&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;Weighted Up-Down&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;UML&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;PSI&quot;</span>
                                    <span class="s2">&quot;Constant m-Intervals n-Alternatives&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Now our frequency discrimination task supports also the constant paradigm.</p>
</section>
<section id="showing-hiding-widgets-dynamically">
<h4>Showing/Hiding Widgets Dynamically<a class="headerlink" href="#showing-hiding-widgets-dynamically" title="Permalink to this heading"></a></h4>
<p>Often you may want to write a single experiment that can handle a number
of different experimental conditions. This usually leads to a growing number
of widgets in the control window that can be distracting.
To address this issue, in <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> it is possible to dinamically
show or hide widgets depending on the value taken by chooser widgets.
To do this, you need to write a function called <code class="docutils literal notranslate"><span class="pre">get_fields_to_hide_</span></code>
that specifies the conditions upon which certain widgets are shown or hidden.</p>
<p>For a practical example, let’s extend the frequency discrimination experiment
described in the sections above so that it can handle not only conditions in
which the standard frequency is fixed, but also conditions in which the standard
frequency is roved from trial to trial within a specified frequency range.
In the <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function of our frequency discrimination
experiment we had a text field for setting the standard frequency:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>now we’ll add two additional text fields to set the frequency range for the
roved-frequency case:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Min. Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>

<span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Max. Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4000</span><span class="p">)</span>
</pre></div>
</div>
<p>we also add a chooser to control whether for the current block the standard frequency
should be fixed or roved:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">chooserOptions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Fixed&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;Roved&quot;</span><span class="p">])</span>
<span class="n">chooserLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Standard Frequency:&quot;</span><span class="p">)</span>
<span class="n">chooser</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Fixed&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">get_fields_to_hide_</span></code> for this experiment is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">get_fields_to_hide_freq</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
<span class="linenos">2</span>   <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">chooser</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Standard Frequency:&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Fixed&quot;</span><span class="p">:</span>
<span class="linenos">3</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToHide</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Min. Frequency (Hz)&quot;</span><span class="p">),</span>
<span class="linenos">4</span>                             <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Max. Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">5</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToShow</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">6</span>   <span class="k">elif</span> <span class="n">parent</span><span class="o">.</span><span class="n">chooser</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Standard Frequency:&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Roved&quot;</span><span class="p">:</span>
<span class="linenos">7</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToHide</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">8</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToShow</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Min. Frequency (Hz)&quot;</span><span class="p">),</span>
<span class="linenos">9</span>                             <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Max. Frequency (Hz)&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>As for the other experiment functions that we have discussed before,
the actual name is the concatenation of a prefix, in this case
<code class="docutils literal notranslate"><span class="pre">get_fields_to_hide_</span></code>, and the name of the experiment file,
in this case <code class="docutils literal notranslate"><span class="pre">freq</span></code>. As you can see on line 1, this function takes as an
argument <code class="docutils literal notranslate"><span class="pre">parent</span></code>, which contains the lists of widgets for the current experiment.
We need to tell the <code class="docutils literal notranslate"><span class="pre">get_fields_to_hide_</span></code> function that if the standard frequency
is fixed, it should show only the <code class="docutils literal notranslate"><span class="pre">Frequency</span> <span class="pre">(Hz)</span></code> text field, and hide the
<code class="docutils literal notranslate"><span class="pre">Min.</span> <span class="pre">Frequency</span> <span class="pre">(Hz)</span></code> and <code class="docutils literal notranslate"><span class="pre">Max.</span> <span class="pre">Frequency</span> <span class="pre">(Hz)</span></code> text fields. Vice-versa,
if the standard frequency is roved, it should show only the
<code class="docutils literal notranslate"><span class="pre">Min.</span> <span class="pre">Frequency</span> <span class="pre">(Hz)</span></code> and <code class="docutils literal notranslate"><span class="pre">Max.</span> <span class="pre">Frequency</span> <span class="pre">(Hz)</span></code> text fields, and hide the
<code class="docutils literal notranslate"><span class="pre">Frequency</span> <span class="pre">(Hz)</span></code> text field. On line 2 we start an <code class="docutils literal notranslate"><span class="pre">if</span></code> block which
will be executed if the value of the <code class="docutils literal notranslate"><span class="pre">Standard</span> <span class="pre">Frequency</span></code> chooser (retrieved
by the <code class="docutils literal notranslate"><span class="pre">currentText</span></code> attribute), is set to <code class="docutils literal notranslate"><span class="pre">Fixed</span></code>. Note how we exploit
once again the <code class="docutils literal notranslate"><span class="pre">chooserLabel</span></code> to find the index of the chooser we want
with <code class="docutils literal notranslate"><span class="pre">parent.prm['chooserLabel'].index(&quot;Standard</span> <span class="pre">Frequency:&quot;)</span></code>.
Next, we define two lists, one containing the indexes of the fields to hide
<code class="docutils literal notranslate"><span class="pre">parent.fieldsToHide</span></code>, and one containing the indexes of the fields to show
<code class="docutils literal notranslate"><span class="pre">parent.fieldsToShow</span></code>. Once more we exploit the <code class="docutils literal notranslate"><span class="pre">fieldLabel</span></code> to retrieve
the indexes of the fields we want to get
(e.g. <code class="docutils literal notranslate"><span class="pre">parent.prm['fieldLabel'].index(&quot;Min.</span> <span class="pre">Frequency</span> <span class="pre">(Hz)&quot;)</span></code>).
From line 6 to line 9 we handle the case in which the standard frequency is
roved. The logic of the code is the same as for the fixed standard frequency
case.</p>
<p>To complete the experiment we need to add a couple of lines to the <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code>
function to handle the case in which the standard frequency is roved.
The new function is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">doTrial_freq2</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
<span class="linenos"> 2</span>   <span class="n">currBlock</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;currentBlock&#39;</span><span class="p">])</span>
<span class="linenos"> 3</span>   <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;startOfBlock&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 4</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">]</span> <span class="o">=</span> \
<span class="linenos"> 5</span>        <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Difference (%)&quot;</span><span class="p">)]</span>
<span class="linenos"> 6</span>      <span class="n">parent</span><span class="o">.</span><span class="n">writeResultsHeader</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>   <span class="n">frequency</span> <span class="o">=</span> \
<span class="linenos"> 9</span>     <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">10</span>   <span class="n">minFrequency</span> <span class="o">=</span> \
<span class="linenos">11</span>     <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Min. Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">12</span>   <span class="n">maxFrequency</span> <span class="o">=</span> \
<span class="linenos">13</span>     <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Max. Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">14</span>   <span class="n">level</span> <span class="o">=</span> \
<span class="linenos">15</span>     <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Level (dB SPL)&quot;</span><span class="p">)]</span>
<span class="linenos">16</span>   <span class="n">duration</span> <span class="o">=</span> \
<span class="linenos">17</span>     <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Duration (ms)&quot;</span><span class="p">)]</span>
<span class="linenos">18</span>   <span class="n">ramps</span> <span class="o">=</span> \
<span class="linenos">19</span>     <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Ramps (ms)&quot;</span><span class="p">)]</span>
<span class="linenos">20</span>   <span class="n">phase</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">21</span>   <span class="n">channel</span> <span class="o">=</span> \
<span class="linenos">22</span>     <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;chooser&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Ear:&quot;</span><span class="p">)]</span>
<span class="linenos">23</span>   <span class="n">stdFreq</span> <span class="o">=</span> \
<span class="linenos">24</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;chooser&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Standard Frequency:&quot;</span><span class="p">)]</span>
<span class="linenos">25</span>
<span class="linenos">26</span>   <span class="k">if</span> <span class="n">stdFreq</span> <span class="o">==</span> <span class="s2">&quot;Roved&quot;</span><span class="p">:</span>
<span class="linenos">27</span>      <span class="n">frequency</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minFrequency</span><span class="p">,</span> <span class="n">maxFrequency</span><span class="p">)</span>
<span class="linenos">28</span>   <span class="n">correctFrequency</span> <span class="o">=</span> <span class="n">frequency</span> <span class="o">+</span> <span class="p">(</span><span class="n">frequency</span><span class="o">*</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">100</span>
<span class="linenos">29</span>   <span class="n">stimulusCorrect</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">correctFrequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span>
<span class="linenos">30</span>                              <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span>
<span class="linenos">31</span>                              <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">32</span>
<span class="linenos">33</span>   <span class="n">stimulusIncorrect</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">34</span>   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;nIntervals&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
<span class="linenos">35</span>      <span class="n">thisSnd</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">frequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span>
<span class="linenos">36</span>                         <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">37</span>      <span class="n">stimulusIncorrect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisSnd</span><span class="p">)</span>
<span class="linenos">38</span>   <span class="n">parent</span><span class="o">.</span><span class="n">playRandomisedIntervals</span><span class="p">(</span><span class="n">stimulusCorrect</span><span class="p">,</span> <span class="n">stimulusIncorrect</span><span class="p">)</span>
</pre></div>
</div>
<p>On lines 10-13 we read off the minimum and maximum frequency values for the roved-standard case. On line 23-24 we retrieve the
value of the <code class="docutils literal notranslate"><span class="pre">Standard</span> <span class="pre">Frequency:</span></code> chooser. On lines 26-27 we state that if the value of the standard frequency chooser
is equal to <code class="docutils literal notranslate"><span class="pre">Roved</span></code>, then the standard frequency for that trial should be drawn from a uniform distribution ranging
from <code class="docutils literal notranslate"><span class="pre">minFrequency</span></code> to <code class="docutils literal notranslate"><span class="pre">maxFrequency</span></code>. The rest of the function is unchanged. Note that we’re using the a Python module
called <code class="docutils literal notranslate"><span class="pre">random</span></code> on line 27, so we need to add <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">random</span></code> at the top of our <code class="docutils literal notranslate"><span class="pre">freq.py</span></code> file.</p>
<p>It is also possible to show/hide choosers. Let’s extend the frequency-discrimination experiment by allowing for the possibility
that the standard frequency is roved on a log scale (which in fact would be a better choice given that frequency scaling in the auditory
system is approximately logarithmic). To do this, we first add a new chooser to set the roving scale:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">chooserOptions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Linear&quot;</span><span class="p">,</span>
                       <span class="s2">&quot;Log&quot;</span><span class="p">])</span>
<span class="n">chooserLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Roving Scale:&quot;</span><span class="p">)</span>
<span class="n">chooser</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Linear&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Because this chooser is useful only when the standard frequency is roved, we’ll tell the <code class="docutils literal notranslate"><span class="pre">get_fields_to_hide_</span></code> function to show/hide
it depending on the value of the <code class="docutils literal notranslate"><span class="pre">Standard</span> <span class="pre">Frequency</span></code> chooser. The new <code class="docutils literal notranslate"><span class="pre">get_fields_to_hide_</span></code> function is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">get_fields_to_hide_freq</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
<span class="linenos"> 2</span>   <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">chooser</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Standard Frequency:&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Fixed&quot;</span><span class="p">:</span>
<span class="linenos"> 3</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToHide</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Min. Frequency (Hz)&quot;</span><span class="p">),</span>
<span class="linenos"> 4</span>                             <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Max. Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos"> 5</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToShow</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos"> 6</span>      <span class="n">parent</span><span class="o">.</span><span class="n">choosersToHide</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Roving Scale:&quot;</span><span class="p">)]</span>
<span class="linenos"> 7</span>   <span class="k">elif</span> <span class="n">parent</span><span class="o">.</span><span class="n">chooser</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Standard Frequency:&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Roved&quot;</span><span class="p">:</span>
<span class="linenos"> 8</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToHide</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos"> 9</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToShow</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Min. Frequency (Hz)&quot;</span><span class="p">),</span>
<span class="linenos">10</span>                             <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Max. Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">11</span>      <span class="n">parent</span><span class="o">.</span><span class="n">choosersToShow</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Roving Scale:&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>We’ve just added two lines. Line 6 gets executed if the <code class="docutils literal notranslate"><span class="pre">Standard</span> <span class="pre">Frequency</span></code> chooser is set to <code class="docutils literal notranslate"><span class="pre">Fixed</span></code>,
and adds the <code class="docutils literal notranslate"><span class="pre">Roving</span> <span class="pre">Scale</span></code> chooser to the <code class="docutils literal notranslate"><span class="pre">parent.choosersToHide</span></code> list.  Line 11 gets executed
if the <code class="docutils literal notranslate"><span class="pre">Standard</span> <span class="pre">Frequency</span></code> chooser is set to <code class="docutils literal notranslate"><span class="pre">Roved</span></code>, and adds the <code class="docutils literal notranslate"><span class="pre">Roving</span> <span class="pre">Scale</span></code> chooser to the <code class="docutils literal notranslate"><span class="pre">parent.choosersToShow</span></code> list.</p>
<p>Finally, we need to add/modify a couple of lines of the <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function.
First of all we need to read off the value of the new <code class="docutils literal notranslate"><span class="pre">Roving</span> <span class="pre">Scale</span></code> chooser:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rovingScale</span> <span class="o">=</span> \
  <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;chooser&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Roving Scale:&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>second, we need to set the standard frequency depending on whether it is drawn from a linear or a logarithmic distribution:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">stdFreq</span> <span class="o">==</span> <span class="s2">&quot;Roved&quot;</span><span class="p">:</span>
   <span class="k">if</span> <span class="n">rovingScale</span> <span class="o">==</span> <span class="s2">&quot;Linear&quot;</span><span class="p">:</span>
      <span class="n">frequency</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">minFrequency</span><span class="p">,</span> <span class="n">maxFrequency</span><span class="p">)</span>
   <span class="k">elif</span> <span class="n">rovingScale</span> <span class="o">==</span> <span class="s2">&quot;Log&quot;</span><span class="p">:</span>
      <span class="n">frequency</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="n">minFrequency</span><span class="p">),</span> <span class="n">log10</span><span class="p">(</span><span class="n">maxFrequency</span><span class="p">)))</span>
</pre></div>
</div>
<p>Note that we’re using the <code class="docutils literal notranslate"><span class="pre">log10</span></code> function from numpy here, so we need to add <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">numpy</span> <span class="pre">import</span> <span class="pre">log10</span></code>
at the top of our <code class="docutils literal notranslate"><span class="pre">freq.py</span></code> file.</p>
</section>
</section>
</section>
<section id="writing-a-constant-1-interval-2-alternatives-paradigm-experiment">
<h2>Writing a “Constant 1-Interval 2-Alternatives” Paradigm Experiment<a class="headerlink" href="#writing-a-constant-1-interval-2-alternatives-paradigm-experiment" title="Permalink to this heading"></a></h2>
<p>In the next paragraphs we’ll see an example of an experiment using the
“Constant 1-Interval 2-Alternatives” paradigm. The experiment a is simple “Yes/No” signal
detection task. On each trial the listener is presented with a single interval which may
or may not contain a pure tone, and s/he has to tell if the tone was present or not.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function for the signal detection experiment is shown below, since the
general framework for writing an experiment is the same as for the adaptive paradigm,
only the differences from an adaptive-paradigm experiment will be highlited.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">initialize_sig_detect</span><span class="p">(</span><span class="n">prm</span><span class="p">):</span>
<span class="linenos"> 2</span>   <span class="n">exp_name</span> <span class="o">=</span> <span class="s2">&quot;Signal Detection Demo&quot;</span>
<span class="linenos"> 3</span>   <span class="n">prm</span><span class="p">[</span><span class="s2">&quot;experimentsChoices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp_name</span><span class="p">)</span>
<span class="linenos"> 4</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 5</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;paradigmChoices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Constant 1-Interval 2-Alternatives&quot;</span><span class="p">]</span>
<span class="linenos"> 6</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;opts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hasFeedback&quot;</span><span class="p">]</span>
<span class="linenos"> 7</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;buttonLabels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">]</span>
<span class="linenos"> 8</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNIntervals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 9</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNAlternatives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">10</span>
<span class="linenos">11</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;execString&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sig_detect&quot;</span>
<span class="linenos">12</span>   <span class="k">return</span> <span class="n">prm</span>
</pre></div>
</div>
<p>On line 5 we list the available paradigms for the experiment, in this case the
only paradigm possible is <code class="docutils literal notranslate"><span class="pre">Constant</span> <span class="pre">1-Interval</span> <span class="pre">2-Alternatives</span></code>. On line 7 we
insert <code class="docutils literal notranslate"><span class="pre">hasFeedback</span></code> to the list of experiment options, so that feedback can
be provided at the end of each trial. Since we’ll have a single observation
interval we don’t add the <code class="docutils literal notranslate"><span class="pre">hasISIBox</span></code> option, because we don’t need to have a
silent inteval between observation intervals. On line 7, we set the labels for
the buttons, which represent the two response alternatives: “Yes” or “No”.
On line 8 and line 9 we set the number of intervals and the number of
response alternatives.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function for the signal detection
experiment is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">select_default_parameters_sig_detect</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>   <span class="n">field</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 4</span>   <span class="n">fieldLabel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 5</span>   <span class="n">chooser</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 6</span>   <span class="n">chooserLabel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 7</span>   <span class="n">chooserOptions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">))</span>
<span class="linenos">10</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Duration (ms)&quot;</span><span class="p">))</span>
<span class="linenos">13</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Ramps (ms)&quot;</span><span class="p">))</span>
<span class="linenos">16</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Level (dB SPL)&quot;</span><span class="p">))</span>
<span class="linenos">19</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span>   <span class="n">chooserOptions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Right&quot;</span><span class="p">),</span> <span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Left&quot;</span><span class="p">),</span> <span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Both&quot;</span><span class="p">)])</span>
<span class="linenos">22</span>   <span class="n">chooserLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Channel:&quot;</span><span class="p">))</span>
<span class="linenos">23</span>   <span class="n">chooser</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Both&quot;</span><span class="p">))</span>
<span class="linenos">24</span>
<span class="linenos">25</span>   <span class="n">prm</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">26</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
<span class="linenos">27</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fieldLabel</span>
<span class="linenos">28</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chooser</span>
<span class="linenos">29</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chooserLabel</span>
<span class="linenos">30</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserOptions&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">chooserOptions</span>
<span class="linenos">31</span>
<span class="linenos">32</span>   <span class="k">return</span> <span class="n">prm</span>
</pre></div>
</div>
<p>there is nothing really new here compared to experiments with adaptive
paradigms that we have seen before. We initialize the text fields that we need
in order to set the frequency duration and level of the signal. We also
initialize a chooser to set the channels on which the signal should be presented.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function for the signal detection task is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">doTrial_sig_detect</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>   <span class="n">currBlock</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;currentBlock&#39;</span><span class="p">])</span>
<span class="linenos"> 4</span>   <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;startOfBlock&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 5</span>       <span class="n">parent</span><span class="o">.</span><span class="n">writeResultsHeader</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="linenos"> 6</span>       <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;conditions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span><span class="s2">&quot;No&quot;</span><span class="p">]</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>   <span class="n">parent</span><span class="o">.</span><span class="n">currentCondition</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;conditions&#39;</span><span class="p">])</span>
<span class="linenos"> 9</span>   <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">currentCondition</span> <span class="o">==</span> <span class="s1">&#39;Yes&#39;</span><span class="p">:</span>
<span class="linenos">10</span>       <span class="n">parent</span><span class="o">.</span><span class="n">correctButton</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">11</span>   <span class="k">elif</span> <span class="n">parent</span><span class="o">.</span><span class="n">currentCondition</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">:</span>
<span class="linenos">12</span>       <span class="n">parent</span><span class="o">.</span><span class="n">correctButton</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">13</span>
<span class="linenos">14</span>   <span class="n">freq</span>    <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">15</span>   <span class="n">dur</span>     <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Duration (ms)&quot;</span><span class="p">)]</span>
<span class="linenos">16</span>   <span class="n">ramps</span>   <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Ramps (ms)&quot;</span><span class="p">)]</span>
<span class="linenos">17</span>   <span class="n">lev</span>     <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Level (dB SPL)&quot;</span><span class="p">)]</span>
<span class="linenos">18</span>   <span class="n">phase</span>   <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">19</span>   <span class="n">channel</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;chooser&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Channel:&quot;</span><span class="p">))]</span>
<span class="linenos">20</span>
<span class="linenos">21</span>   <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">currentCondition</span> <span class="o">==</span> <span class="s1">&#39;No&#39;</span><span class="p">:</span>
<span class="linenos">22</span>       <span class="n">lev</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span>
<span class="linenos">23</span>   <span class="n">sig</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">freq</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">dur</span><span class="p">,</span> <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">24</span>
<span class="linenos">25</span>
<span class="linenos">26</span>   <span class="n">parent</span><span class="o">.</span><span class="n">playSequentialIntervals</span><span class="p">([</span><span class="n">sig</span><span class="p">])</span>
</pre></div>
</div>
<p>For experiments using the “Constant 1-Interval 2-Alternatives” paradigm
it is necessary to list the experimental conditions in the <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code>
function. We do this on line 6. On line 8, we bind the response buttons
to the correct response. Since the button number 1 is the “Yes” button, we
say that in the case of a signal trial (<code class="docutils literal notranslate"><span class="pre">parent.currentCondition</span> <span class="pre">==</span> <span class="pre">&quot;Yes&quot;</span></code>)
the correct button to press is the button number 1, otherwise the correct button to press is the button number 2.</p>
<p>On lines 14-23 we read off the values of the text fields and generate the
sound to play (signal or silence) according to the experimental condition.
Finally, on line 25 we use the <code class="docutils literal notranslate"><span class="pre">parent.playSequentialIntervals</span></code> function to
present the sound to the listener. This function accepts as an argument a
list of sounds to play sequentially. In our case we have only a single
sound to insert in the list. More details on the <code class="docutils literal notranslate"><span class="pre">playSequentialIntervals</span></code>
function are provided in Section <a class="reference internal" href="#sec-play-sound-functions"><span class="std std-ref">The Play Sound Functions</span></a>.</p>
</section>
<section id="writing-an-experiment-for-the-transformed-up-down-interleaved-weighted-up-down-interleaved-and-multiple-constants-m-intervals-n-alternatives-paradigms">
<h2>Writing an experiment for the Transformed Up-Down Interleaved, Weighted Up-Down Interleaved, and Multiple Constants m-Intervals n-Alternatives Paradigms<a class="headerlink" href="#writing-an-experiment-for-the-transformed-up-down-interleaved-weighted-up-down-interleaved-and-multiple-constants-m-intervals-n-alternatives-paradigms" title="Permalink to this heading"></a></h2>
<p>This section will walk you through an example of an experiment that can be
used with the transformed up-down interleaved and weighted up-down interleaved
paradigms. These paradigms are simple extensions of the transformed up-down and
weighted up-down paradigms in which multiple independent adaptive tracks are
run simultaneously and are randomly interleaved in a single block of trials.</p>
<p>Because experiments that support
the transformed up-down interleaved and weighted up-down interleaved
paradigms can be easily modified to support also the multiple constants m-intervals n-alternatives
paradigm, this paradigm will be also added in our example experiment. This paradigm is a simple
extension of the constant m-intervals n-alternatives paradigm, in which rather than having a single
constant difference between the standard and comparison tones, multiple constant differences are
tested in a single block of trials.</p>
<p>The example experiment that we’ll look at is a simple signal detection in quiet experiment, that could be used
to measure an audiogram. For this reason it is called “Demo Audiogram Multiple Frequencies” (it can be
found in the file <code class="docutils literal notranslate"><span class="pre">audiogram_mf.py</span></code> in the <code class="docutils literal notranslate"><span class="pre">default_experiments</span></code> folder). The experiment can
be used to setup a virtually unlimited number of adaptive tracks, and each track can be used to track the signal-detection
threshold for a specific frequency.</p>
<p>As for the multiple constants procedure, the experiment could be similarly used to measure percent correct performance
for tones of different frequencies presented at the same level. However, a more interesting possibility is to use the
experiment to measure percent correct performance for the same frequency at different fixed levels. This could then be
used to derive a psychometric function relating percent correct performance to signal level.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function of the experiment is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">initialize_audiogram_mf</span><span class="p">(</span><span class="n">prm</span><span class="p">):</span>
<span class="linenos"> 2</span>   <span class="n">exp_name</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Demo Audiogram Multiple Frequencies&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="linenos"> 3</span>   <span class="n">prm</span><span class="p">[</span><span class="s2">&quot;experimentsChoices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp_name</span><span class="p">)</span>
<span class="linenos"> 4</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 5</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;paradigmChoices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Transformed Up-Down Interleaved&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="linenos"> 6</span>                                     <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Weighted Up-Down Interleaved&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="linenos"> 7</span>                                     <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Multiple Constants m-Intervals n-Alternatives&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)]</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;opts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hasISIBox&quot;</span><span class="p">,</span> <span class="s2">&quot;hasAlternativesChooser&quot;</span><span class="p">,</span> <span class="s2">&quot;hasFeedback&quot;</span><span class="p">,</span>
<span class="linenos">11</span>                          <span class="s2">&quot;hasNTracksChooser&quot;</span><span class="p">]</span>
<span class="linenos">12</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultAdaptiveType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Arithmetic&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="linenos">13</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNIntervals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">14</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNAlternatives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">15</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNTracks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="linenos">16</span>
<span class="linenos">17</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;execString&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;audiogram_mf&quot;</span>
<span class="linenos">18</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="linenos">19</span>
<span class="linenos">20</span> <span class="k">return</span> <span class="n">prm</span>
</pre></div>
</div>
<p>the first part of the function doesn’t need much explanation if you’ve follwed the previous examples.
The experiments <code class="docutils literal notranslate"><span class="pre">opts</span></code> has a new item <code class="docutils literal notranslate"><span class="pre">hasNTracksChooser</span></code>. This option allows the user to dynamically
change the number of adaptive tracks to be used (or the number of constant differences to measure for the
multiple constants paradigm). Besides this, the only new thing compared to previous examples is that
we also specify the default number of tracks with <code class="docutils literal notranslate"><span class="pre">prm[exp_name]['defaultNTracks']</span> <span class="pre">=</span> <span class="pre">4</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> for the “Demo Audiogram Multiple Frequencies” experiment is shown
below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">select_default_parameters_audiogram_mf</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>   <span class="n">nDifferences</span> <span class="o">=</span> <span class="n">par</span><span class="p">[</span><span class="s1">&#39;nDifferences&#39;</span><span class="p">]</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>   <span class="n">field</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 6</span>   <span class="n">fieldLabel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 7</span>   <span class="n">chooser</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 8</span>   <span class="n">chooserLabel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 9</span>   <span class="n">chooserOptions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">10</span>
<span class="linenos">11</span>   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nDifferences</span><span class="p">):</span>
<span class="linenos">12</span>      <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz) &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
<span class="linenos">13</span>      <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1000</span><span class="o">+</span><span class="mi">1000</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
<span class="linenos">14</span>      <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Level (dB SPL) &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">15</span>      <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="linenos">16</span>
<span class="linenos">17</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Bandwidth (Hz)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">18</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Duration (ms)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">21</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Ramps (ms)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">24</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos">25</span>
<span class="linenos">26</span>
<span class="linenos">27</span>   <span class="n">chooserOptions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Right&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="linenos">28</span>                        <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Left&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="linenos">29</span>                        <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Both&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)])</span>
<span class="linenos">30</span>   <span class="n">chooserLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Ear:&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">31</span>   <span class="n">chooser</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Right&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">32</span>   <span class="n">chooserOptions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Sinusoid&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="linenos">33</span>                        <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Narrowband Noise&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)])</span>
<span class="linenos">34</span>   <span class="n">chooserLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Type:&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">35</span>   <span class="n">chooser</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Sinusoid&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">36</span>
<span class="linenos">37</span>   <span class="n">prm</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">38</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
<span class="linenos">39</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fieldLabel</span>
<span class="linenos">40</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chooser</span>
<span class="linenos">41</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chooserLabel</span>
<span class="linenos">42</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserOptions&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">chooserOptions</span>
<span class="linenos">43</span>
<span class="linenos">44</span>   <span class="k">return</span> <span class="n">prm</span>
</pre></div>
</div>
<p>The transformed/weighted up-down interleaved paradigms can be run with any
number of adaptive tracks. Similarly, the multiple constants m-intervals
n-alternatives procedure can be run with any number of constant differences
between the standard and comparison intervals. All the user has to do is
select the desired number of adaptive tracks, or constant differences
from the appropriate chooser in the <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> control window.
<code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function, however, needs to know how
many tracks or how many constant differences are being run in order to set
up the necessary fields storing the experimental variables.
The <code class="docutils literal notranslate"><span class="pre">par</span></code> argument that is always passed to the <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code>
function has the purpose of passing additional parameters to dinamycally modify
the behavior of the function in cases like this.</p>
<p>In the case of paradigms with interleaved tracks, or multiple constant differences
the <code class="docutils literal notranslate"><span class="pre">par</span></code> argument has a key called <code class="docutils literal notranslate"><span class="pre">nDifferences</span></code> that specifies the
number of tracks or constant differences. For the current experiment we
retieve this value on line 3. Then, on lines 11-15 we set up a for loop
in which we add a field to store the frequency and level of the tones for
each adaptive track. The rest of the function is similar to previous examples,
so it will not be discussed further.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">get_fields_to_hide_</span></code> function for the “Demo Audiogram Multiple Frequencies”
experiment is shown in the code block below. Again, nothing new here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">get_fields_to_hide_audiogram_mf</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
<span class="linenos">2</span>   <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">chooser</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Type:&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Sinusoid&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="linenos">3</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToHide</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Bandwidth (Hz)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]</span>
<span class="linenos">4</span>   <span class="k">else</span><span class="p">:</span>
<span class="linenos">5</span>      <span class="n">parent</span><span class="o">.</span><span class="n">fieldsToShow</span> <span class="o">=</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Bandwidth (Hz)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function for the “Demo Audiogram Multiple Frequencies” experiment
is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">doTrial_audiogram_mf</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
<span class="linenos"> 2</span>   <span class="n">currBlock</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;currentBlock&#39;</span><span class="p">])</span>
<span class="linenos"> 3</span>   <span class="n">nDifferences</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;nDifferences&#39;</span><span class="p">]</span>
<span class="linenos"> 4</span>   <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;startOfBlock&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 5</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;additional_parameters_to_write&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 6</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;conditions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 7</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 8</span>      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nDifferences</span><span class="p">):</span>
<span class="linenos"> 9</span>         <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;conditions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Frequency (Hz) &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">))]))</span>
<span class="linenos">10</span>         <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Level (dB SPL) &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">))])</span>
<span class="linenos">11</span>      <span class="n">parent</span><span class="o">.</span><span class="n">writeResultsHeader</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="linenos">12</span>
<span class="linenos">13</span>   <span class="n">frequency</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">14</span>   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nDifferences</span><span class="p">):</span>
<span class="linenos">15</span>      <span class="n">frequency</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Frequency (Hz) &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">))])</span>
<span class="linenos">16</span>
<span class="linenos">17</span>   <span class="n">parent</span><span class="o">.</span><span class="n">currentCondition</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;conditions&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;currentDifference&#39;</span><span class="p">]]</span> <span class="c1">#this is necessary for counting correct/total trials</span>
<span class="linenos">18</span>   <span class="n">correctLevel</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;currentDifference&#39;</span><span class="p">]]</span>
<span class="linenos">19</span>
<span class="linenos">20</span>   <span class="n">currentFrequency</span> <span class="o">=</span> <span class="n">frequency</span><span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;currentDifference&#39;</span><span class="p">]]</span>
<span class="linenos">21</span>   <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Bandwidth (Hz)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]</span>
<span class="linenos">22</span>   <span class="n">phase</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">23</span>
<span class="linenos">24</span>   <span class="n">incorrectLevel</span> <span class="o">=</span> <span class="o">-</span><span class="mi">200</span>
<span class="linenos">25</span>   <span class="n">duration</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Duration (ms)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]</span>
<span class="linenos">26</span>   <span class="n">ramps</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Ramps (ms)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]</span>
<span class="linenos">27</span>   <span class="n">channel</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;chooser&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Ear:&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]</span>
<span class="linenos">28</span>   <span class="n">sndType</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;chooser&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Type:&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))]</span>
<span class="linenos">29</span>
<span class="linenos">30</span>   <span class="k">if</span> <span class="n">sndType</span> <span class="o">==</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Narrowband Noise&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="linenos">31</span>      <span class="k">if</span> <span class="n">bandwidth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">32</span>         <span class="n">parent</span><span class="o">.</span><span class="n">stimulusCorrect</span> <span class="o">=</span> <span class="n">steepNoise</span><span class="p">(</span><span class="n">currentFrequency</span><span class="o">-</span><span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">currentFrequency</span><span class="o">+</span><span class="p">(</span><span class="n">bandwidth</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="n">correctLevel</span> <span class="o">-</span> <span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">bandwidth</span><span class="p">)),</span>
<span class="linenos">33</span>                                             <span class="n">duration</span><span class="p">,</span> <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">34</span>      <span class="k">else</span><span class="p">:</span>
<span class="linenos">35</span>         <span class="n">parent</span><span class="o">.</span><span class="n">stimulusCorrect</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">currentFrequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">correctLevel</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">36</span>   <span class="k">elif</span> <span class="n">sndType</span> <span class="o">==</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Sinusoid&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="linenos">37</span>      <span class="n">parent</span><span class="o">.</span><span class="n">stimulusCorrect</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">currentFrequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">correctLevel</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">38</span>
<span class="linenos">39</span>
<span class="linenos">40</span>   <span class="n">parent</span><span class="o">.</span><span class="n">stimulusIncorrect</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">41</span>   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;nIntervals&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
<span class="linenos">42</span>      <span class="n">thisSnd</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">currentFrequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">incorrectLevel</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">43</span>      <span class="n">parent</span><span class="o">.</span><span class="n">stimulusIncorrect</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisSnd</span><span class="p">)</span>
<span class="linenos">44</span>   <span class="n">parent</span><span class="o">.</span><span class="n">playRandomisedIntervals</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">stimulusCorrect</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">stimulusIncorrect</span><span class="p">)</span>
</pre></div>
</div>
<p>note that on line 3 we retrieve the number of adaptive tracks (for adaptive interleaved
paradigms), or the number of constant differences (for multiple constant paradigms) that
we’re currently running. This parameter is stored in the <code class="docutils literal notranslate"><span class="pre">parent.prm</span></code> dictionary.</p>
<p>At the start of a block of trials (cfr. line 4) we set up a number of parameters.
Among these there are two in particular that need some explanation. The
<a href="#id1"><span class="problematic" id="id2">``</span></a>parent.prm[‘adaptiveParam’] on line 7 is a list that is populated in the for loop
starting on line 9 with the initial values of the parameter that is adaptively varying
for each track. The <a href="#id3"><span class="problematic" id="id4">``</span></a>parent.prm[‘conditions’] on the other hand is a parameter
that is used only when the experiment is run with the multiple constants m-intervals
n-alternatives paradigm. It’s a list of labels for each “condition” that is being
run in the experiment, that is for each constant difference that is being tested.</p>
<p>On lines 13-15 we retrieve the frequencies of the tones used for each track or
constant difference.</p>
<p>On line 17 we retrieve the label of the current condition and store it in the
<code class="docutils literal notranslate"><span class="pre">parent.currentCondition</span></code> variable. Thisvariable will be used by <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code>
for keeping count of the correct and total number of trials for each constant
difference when using the multiple constants paradigm. Note how the
<code class="docutils literal notranslate"><span class="pre">parent.prm['currentDifference']</span></code> variable is used for this purpose. This variable
is the index to the current track or current cosnatnt difference that is being
currently tested. This variable is set outside of the <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function,
(a random track or constant difference is chosen for each trial) but
we can retrieve its value through the <code class="docutils literal notranslate"><span class="pre">parent</span></code> handle.</p>
<p>On line 18 we make use of the <code class="docutils literal notranslate"><span class="pre">parent.prm['currentDifference']</span></code> variable again, this
time to retrieve the level of the comparison stimulus for the track or constant difference
that is run on the current trial. The rest of the function is not different from
the <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> functions used in transformed/weighted up-down paradigms with
non-interleaved tracks, and should be easy to follow if you’ve followed the previous
examples.</p>
<section id="writing-a-matching-experiment-using-interleaved-adaptive-tracks">
<h3>Writing a matching experiment using interleaved adaptive tracks<a class="headerlink" href="#writing-a-matching-experiment-using-interleaved-adaptive-tracks" title="Permalink to this heading"></a></h3>
<p>The transformed up-down and weighted up-down interleaved procedures can be used
to write matching experiments. As described by <a class="reference internal" href="references.html#jesteadt1980" id="id5"><span>[Jesteadt1980]</span></a>, two interleaved
adaptive tracks can be used to target points on the psychometric function that
are symmetric around the 50% point (e.g. 71% and 29%), and then average the
threshold in each track in order to estimate the point of subjective equality.
For example, in a level-matching experiment one track could target the point
at which the listener judges the comparison tone to be louder than the standard
tone 71% of the time, while the other track targets the point at which the listener
judges the comparison tone to be louder than the standard 29% of the time (or equivalently,
softer than the standard 71% of the time).</p>
<p>In this section we’ll show how to write in <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> a level-matching
experiment similar to the one described by <a class="reference internal" href="references.html#jesteadt1980" id="id6"><span>[Jesteadt1980]</span></a>. This experiment is
one of the default experiments available in <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code>, and is called
<code class="docutils literal notranslate"><span class="pre">Demo</span> <span class="pre">Level</span> <span class="pre">Matching</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">initialize_</span></code> function of the experiment is shown in the code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">initialize_lev_match</span><span class="p">(</span><span class="n">prm</span><span class="p">):</span>
<span class="linenos"> 2</span>   <span class="n">exp_name</span> <span class="o">=</span> <span class="s2">&quot;Demo Level Matching&quot;</span>
<span class="linenos"> 3</span>   <span class="n">prm</span><span class="p">[</span><span class="s2">&quot;experimentsChoices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp_name</span><span class="p">)</span>
<span class="linenos"> 4</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos"> 5</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;paradigmChoices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Transformed Up-Down Interleaved&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span>                                       <span class="s2">&quot;Weighted Up-Down Interleaved&quot;</span><span class="p">]</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;opts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hasISIBox&quot;</span><span class="p">,</span> <span class="s2">&quot;hasAlternativesChooser&quot;</span><span class="p">]</span>
<span class="linenos"> 9</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultAdaptiveType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Arithmetic&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="linenos">10</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNIntervals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">11</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNAlternatives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">12</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s1">&#39;defaultNTracks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="linenos">13</span>   <span class="n">prm</span><span class="p">[</span><span class="n">exp_name</span><span class="p">][</span><span class="s2">&quot;execString&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lev_match&quot;</span>
</pre></div>
</div>
<p>among the <code class="docutils literal notranslate"><span class="pre">paradigmChoices</span></code> we include the “Transformed Up-Down Interleaved”,
and the “Weighted Up-Down Interleaved”. The experiment has just two experiment <code class="docutils literal notranslate"><span class="pre">opts</span></code>:
one to add an ISI box, the other one to add an alternatives chooser (we’ll probably want to
run this experiment only with two intervals, and two alternatives, so in principle we could
do without the alternative chooser, but currently, for technical reasons the <code class="docutils literal notranslate"><span class="pre">hasAlternativesChooser</span></code>
option has to be added with the “Transformed Up-Down Interleaved”, and the “Weighted Up-Down Interleaved”
paradigms). Besides specifying the default number of intervals and alternatives,
we also specify the default number of interleaved tracks using the <code class="docutils literal notranslate"><span class="pre">defaultNTracks</span></code> key. Because we
have not added a <code class="docutils literal notranslate"><span class="pre">hasNTracksChooser</span></code> in the experiment the default number of tracks specified here
will be the default and only possible number of tracks in the experiment.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">select_default_parameters_lev_match</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>   <span class="n">field</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 4</span>   <span class="n">fieldLabel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 5</span>   <span class="n">chooser</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 6</span>   <span class="n">chooserLabel</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 7</span>   <span class="n">chooserOptions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Starting Level Track 1 (dB SPL)&quot;</span><span class="p">)</span>
<span class="linenos">10</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">75</span><span class="p">)</span>
<span class="linenos">11</span>
<span class="linenos">12</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Starting Level Track 2 (dB SPL)&quot;</span><span class="p">)</span>
<span class="linenos">13</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">55</span><span class="p">)</span>
<span class="linenos">14</span>
<span class="linenos">15</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Frequency Standard Tone (Hz)&quot;</span><span class="p">))</span>
<span class="linenos">16</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Frequency Comparison Tone (Hz)&quot;</span><span class="p">))</span>
<span class="linenos">19</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span>
<span class="linenos">20</span>
<span class="linenos">21</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Level Standard Tone (dB SPL)&quot;</span><span class="p">))</span>
<span class="linenos">22</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">65</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Duration (ms)&quot;</span><span class="p">))</span>
<span class="linenos">25</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">180</span><span class="p">)</span>
<span class="linenos">26</span>
<span class="linenos">27</span>   <span class="n">fieldLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;Ramps (ms)&quot;</span><span class="p">))</span>
<span class="linenos">28</span>   <span class="n">field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="linenos">29</span>
<span class="linenos">30</span>   <span class="n">chooserOptions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Right&quot;</span><span class="p">,</span> <span class="s2">&quot;Left&quot;</span><span class="p">,</span> <span class="s2">&quot;Both&quot;</span><span class="p">])</span>
<span class="linenos">31</span>   <span class="n">chooserLabel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Ear:&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">32</span>   <span class="n">chooser</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;Both&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="linenos">33</span>
<span class="linenos">34</span>
<span class="linenos">35</span>   <span class="n">prm</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos">36</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span>
<span class="linenos">37</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fieldLabel</span>
<span class="linenos">38</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooser&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chooser</span>
<span class="linenos">39</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chooserLabel</span>
<span class="linenos">40</span>   <span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserOptions&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">chooserOptions</span>
<span class="linenos">41</span>
<span class="linenos">42</span>   <span class="k">return</span> <span class="n">prm</span>
</pre></div>
</div>
<p>the first two fields will be used to set the starting level of the comparison tone in each track.
The next two fields will be used to set the frequencies of the standard and comparison tone. The
next field will be used to set the level of the standard tone which will be fixed throughout a block
of trials. The last two fields will be used to set the duration of the tone (excluding the ramps),
and the duration of its onset and offset ramps. The only chooser will be used to set the ear to
which the tones will be presented.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">doTrial_</span></code> function for the level matching experiment is shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">def</span> <span class="nf">doTrial_lev_match</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
<span class="linenos"> 2</span>   <span class="n">currBlock</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;currentBlock&#39;</span><span class="p">])</span>
<span class="linenos"> 3</span>   <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;startOfBlock&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 4</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 5</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Starting Level Track 1 (dB SPL)&quot;</span><span class="p">)])</span>
<span class="linenos"> 6</span>      <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Starting Level Track 2 (dB SPL)&quot;</span><span class="p">)])</span>
<span class="linenos"> 7</span>      <span class="n">parent</span><span class="o">.</span><span class="n">writeResultsHeader</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>
<span class="linenos">11</span>  <span class="n">standardFrequency</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency Standard Tone (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">12</span>  <span class="n">comparisonFrequency</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Frequency Comparison Tone (Hz)&quot;</span><span class="p">)]</span>
<span class="linenos">13</span>  <span class="n">standardLevel</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Level Standard Tone (dB SPL)&quot;</span><span class="p">)]</span>
<span class="linenos">14</span>  <span class="n">duration</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Duration (ms)&quot;</span><span class="p">)]</span>
<span class="linenos">15</span>  <span class="n">ramps</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;fieldLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Ramps (ms)&quot;</span><span class="p">)]</span>
<span class="linenos">16</span>  <span class="n">phase</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">17</span>  <span class="n">channel</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="n">currBlock</span><span class="p">][</span><span class="s1">&#39;chooser&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;chooserLabel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;Ear:&quot;</span><span class="p">)]</span>
<span class="linenos">18</span>
<span class="linenos">19</span>  <span class="n">comparisonLevel</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;adaptiveParam&#39;</span><span class="p">][</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;currentDifference&#39;</span><span class="p">]]</span>
<span class="linenos">20</span>
<span class="linenos">21</span>  <span class="n">comparisonTone</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">comparisonFrequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">comparisonLevel</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramps</span><span class="p">,</span>
<span class="linenos">22</span>                            <span class="n">channel</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">23</span>
<span class="linenos">24</span>  <span class="n">standardToneList</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">25</span>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">((</span><span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;nIntervals&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
<span class="linenos">26</span>     <span class="n">thisSnd</span> <span class="o">=</span> <span class="n">pureTone</span><span class="p">(</span><span class="n">standardFrequency</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">standardLevel</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">ramps</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span>
<span class="linenos">27</span>                        <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;sampRate&#39;</span><span class="p">],</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;maxLevel&#39;</span><span class="p">])</span>
<span class="linenos">28</span>     <span class="n">standardToneList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisSnd</span><span class="p">)</span>
<span class="linenos">29</span>  <span class="n">parent</span><span class="o">.</span><span class="n">playRandomisedIntervals</span><span class="p">(</span><span class="n">comparisonTone</span><span class="p">,</span> <span class="n">standardToneList</span><span class="p">)</span>
</pre></div>
</div>
<p>The adaptive parameter for an experiment with interleaved tracks is not a single number, but a list
containing the values of the adaptive parameter for each track. Therefore,
on line 4 we create the list, and on lines 5 and 6 we populate
this list with the initial values of each of the adaptive tracks.</p>
<p>From lines 11 to 17 we retrieve the values of all the fields and choosers. Nothing new here.
On line 19 we retrieve the value of the adaptive parameter (which in this case is the level
of the comparison tone) for the current trial. To do this, we refer to a key in the <code class="docutils literal notranslate"><span class="pre">parent.prm</span></code>
dictionary called <code class="docutils literal notranslate"><span class="pre">currentDifference</span></code>. This key holds the index of the track which
has been randomly selected by <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> for the current trial.</p>
<p>From line 21 to 28 we prepare the stimuli to be presented in the standard and comparison intervals.
We then pass these stimuli as arguments to the <code class="docutils literal notranslate"><span class="pre">playRandomisedIntervals</span></code> functions. This experiment is ready to be run.</p>
<p>The up-down rules of the two adaptive tracks need to be set up
appropriately to run the matching experiment. Let’s,
take as an example the experiment described in <a class="reference internal" href="references.html#jesteadt1980" id="id7"><span>[Jesteadt1980]</span></a> in
which we wish to determine the intensity of a 250-Hz tone required
to match the loudness of a 1000-Hz tone presented at 40 dB SPL.
In the <code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> control window, after having selected
the <code class="docutils literal notranslate"><span class="pre">Demo</span> <span class="pre">Level</span> <span class="pre">Matching</span></code> experiment, we set the frequency of
the standard tone to 1000 Hz, and the frequency of the comparison
tone to 250 Hz. We also set the level of the standard tone to 40 dB SPL.
We then set the upper, and lower tracks to 60 and 30 dB SPL, two values
that should bracket the point of subjective equality.</p>
<p>The task for the
listener is an objective one: s/he will have to tell on each trial
which tone was louder. For track 1, we set the rule down to 2, and the
rule up to 1. For track 2 instead, we set the rule down to 1, and the
rule up to 2. In this way, track 1 will target the point in the
psychometric function at which the listener judges the comparison
tone to be louder than the standard 70.7% of the time. Track 2 will
target instead the point in the psychometric function at which the
listener judges the comparison tone to be louder than the standard
29.3% of the time. For track 1, when the listener chooses the <em>comparison</em>
interval twice in a row the level of the 250-Hz tone (the comparison tone)
is decreased, while each time s/he chooses the standard interval the level of the
250-Hz tone is increased.
For track 2, when the listener chooses the <em>standard</em>
interval twice in a row the level of the 250-Hz tone is increased, while each
time the listener chooses the level of the 250-Hz tone is decreased.
For both tracks “correct” responses move the track down. There are no
correct or incorrect responses in a subjective task like this. The <code class="docutils literal notranslate"><span class="pre">Corr.</span> <span class="pre">Resp.</span> <span class="pre">Move</span> <span class="pre">Track</span> <span class="pre">X</span></code> (down or up) choosers are not named appropriately for this task.
They should be named something like “when the comparison interval is chosen
track X moves” down or up. However, since the underlying code for adaptive
interleaved paradigms is the same for objective and subjective tasks,
for simplicity and ease of maintenance of the underlying code they are called
<code class="docutils literal notranslate"><span class="pre">Corr.</span> <span class="pre">Resp.</span> <span class="pre">Move</span> <span class="pre">Track</span> <span class="pre">X</span></code> (down or up).
.</p>
</section>
</section>
<section id="writing-a-constant-1-pair-same-different-paradigm-experiment">
<h2>Writing a “Constant 1-Pair Same/Different” Paradigm Experiment<a class="headerlink" href="#writing-a-constant-1-pair-same-different-paradigm-experiment" title="Permalink to this heading"></a></h2>
<div class="admonition-todo admonition" id="id8">
<p class="admonition-title">Todo</p>
<p>Describe of to write experiments for the “Constant 1-Pair Same/Different” paradigm.</p>
</div>
</section>
<section id="writing-an-odd-one-out-paradigm-experiment">
<h2>Writing an “Odd One Out” Paradigm Experiment<a class="headerlink" href="#writing-an-odd-one-out-paradigm-experiment" title="Permalink to this heading"></a></h2>
<div class="admonition-todo admonition" id="id9">
<p class="admonition-title">Todo</p>
<p>Describe of to write experiments for the “Odd One Out” paradigm.</p>
</div>
</section>
<section id="the-experiment-opts">
<span id="sec-experiment-opts"></span><h2>The Experiment “opts”<a class="headerlink" href="#the-experiment-opts" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>``hasAlternativesChooser``</strong> This option adds two chooser widgets, one to dynamically
change the number of observation intervals (labelled “Intervals”), and one to dinamically
change the number of response alternatives (labelled “Alternatives).
This option is generally used in adaptive paradigms
(“Transformed Up-Down”, “Weighted Up-Down”, as well as their interleaved versions).
The number of response alternatives that can be choosen from the widget can be either
equal to the number of observation intervals, or to the number of observation intervals
minus one. In the latter case the standard stimulus is presented in the first interval,
as a reference, with no corresponding response alternative, see <a class="reference internal" href="references.html#grimaultetal2002" id="id10"><span>[GrimaultEtAl2002]</span></a>
for an example of this <span class="math notranslate nohighlight">\(n\)</span>-intervals, <span class="math notranslate nohighlight">\(n-1\)</span> alternatives presentation
mode. The selected number of intervals and alternatives can be accessed in the experiment
file through the <code class="docutils literal notranslate"><span class="pre">parent.prm['nIntervals']</span></code>, and <code class="docutils literal notranslate"><span class="pre">parent.prm['nAlternatives']</span></code> variables
respectively.</p></li>
<li><p><strong>``hasAltReps``</strong> This option can be used to change the way in which the
stimuli are presented in the “Transformed Up-Down” paradigm or
other adaptive paradigms. In these paradigms, normally there is an
observation interval containing the target stimulus (comparison interval),
and one or more other intervals containing the non-target stimuli (standard
intervals). An alternative way to present the stimuli is to have an alternation
of the target and non-target stimuli (e.g. ABAB) in the comparison interval,
and a repetition of the non-target stimulus in the standard interval (AAAA)
<a class="reference internal" href="references.html#kingetal2013" id="id11"><span>[KingEtAl2013]</span></a>. If the <code class="docutils literal notranslate"><span class="pre">hasAltReps</span></code> option is enabled, there will be two
additional text boxes, <code class="docutils literal notranslate"><span class="pre">Alternated</span> <span class="pre">(AB)</span> <span class="pre">Reps.</span></code> and <code class="docutils literal notranslate"><span class="pre">Alternated</span> <span class="pre">(AB)</span> <span class="pre">Reps.</span> <span class="pre">ISI</span> <span class="pre">(ms)</span></code>.
The first text box controls the number of times the alternated target and non-target
stimuli should be repeated, a value of zero corresponds to no alternation, that is
only a single stimulus (either the target, or the non target) is presented in each interval.
If the value is one, a single alternation will occur (AB), if the value is two, two alternations
occur (ABAB), and so on. The second text box controls the ISI between the stimuli
presented within an interval. The selected number of alternated repetitions,
and the ISI between alternating stimuli can be accessed in the experiment file
through the <code class="docutils literal notranslate"><span class="pre">parent.prm['altReps']</span></code>, and <code class="docutils literal notranslate"><span class="pre">parent.prm['altRepsISI']</span></code> variables
respectively. The setup of the alternated repetitions must be done within each
experiment file.</p></li>
<li><p><strong>``hasFeedback``</strong> This option controls whether the “Response Light” chooser has
a “Feedback” option or not. You may want to enable this option for all “objective”
experiments that have a clear “correct” response. You may want to disable this option
for “subjective” experiments, such as matching experiments, in which there is no
“correct” response.</p></li>
<li><p><strong>``hasISIBox``</strong> If this option is enabled, a box labelled <code class="docutils literal notranslate"><span class="pre">ISI</span> <span class="pre">(ms)</span></code> is
added. This is generally used to set the silent period between observation
intervals in the “Transformed Up-Down” and similar adaptive procedures.
Its value can be accessed in the experiment file through the
<code class="docutils literal notranslate"><span class="pre">parent.prm['isi']</span></code> variable. However, normally this should not be
necessary because the <code class="docutils literal notranslate"><span class="pre">playRandomisedIntervals</span></code> function automatically
uses this value to set the silent period between observation intervals.</p></li>
<li><p><strong>``hasNDifferencesChooser``</strong> This option is useful in the
“Multiple Constants 1-Interval 2-Alternatives Paradigm” to dinamically
change the number of experimental conditions. For example, if you have
a signal detection experiment in which a fixed number of signals (with
a constant amplitude) can occur, this option allows to choose the
number of conditions dinamically. If this option is enabled, a chooser
labelled <code class="docutils literal notranslate"><span class="pre">No.</span> <span class="pre">Alternatives</span></code> is added. The value selected can be accessed
through the <code class="docutils literal notranslate"><span class="pre">par['nDifferences']</span></code> variable in the
<code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function, and through the
<code class="docutils literal notranslate"><span class="pre">parent.prm['nDifferences']</span></code> variable in the <code class="docutils literal notranslate"><span class="pre">doTrial</span></code> function.</p></li>
<li><p><strong>``hasNTracksChooser``</strong> This option can be used to dinamically change
the number of tracks in interleaved adaptive paradigms (e.g. “Transformed
Up-Down Interleaved). If enabled, a <code class="docutils literal notranslate"><span class="pre">No.</span> <span class="pre">Tracks</span></code> chooser is added.
The value selected can be accessed
through the <code class="docutils literal notranslate"><span class="pre">par['nDifferences']</span></code> variable in the
<code class="docutils literal notranslate"><span class="pre">select_default_parameters_</span></code> function, and through the
<code class="docutils literal notranslate"><span class="pre">parent.prm['nDifferences']</span></code> variable in the <code class="docutils literal notranslate"><span class="pre">doTrial</span></code> function.</p></li>
<li><p><strong>``hasPrecursorInterval``</strong> If this option is enabled, a chooser controlling whether
a precursor interval should be presented or not is added. This chooser is labelled
<code class="docutils literal notranslate"><span class="pre">Precursor</span> <span class="pre">Interval</span></code>. If this option is enabled, and the chooser is set to “Yes”,
then a <code class="docutils literal notranslate"><span class="pre">precursorStim</span></code> sound needs to be passed to the <code class="docutils literal notranslate"><span class="pre">playRandomisedIntervals</span></code>
function. This sound will be presented before each observation interval.</p></li>
<li><p><strong>``hasPostcursorInterval``</strong> If this option is enabled, a chooser controlling whether
a postcursor interval should be presented or not is added. This chooser is labelled
<code class="docutils literal notranslate"><span class="pre">Postcursor</span> <span class="pre">Interval</span></code>. If this option is enabled, and the chooser is set to “Yes”,
then a <code class="docutils literal notranslate"><span class="pre">postcursorStim</span></code> sound needs to be passed to the <code class="docutils literal notranslate"><span class="pre">playRandomisedIntervals</span></code>
function. This sound will be presented after each observation interval.</p></li>
<li><p><strong>``hasPreTrialInterval``</strong> If this option is enabled, a chooser controlling whether
a pre-trial interval should be presented or not is added. This chooser is labelled
<code class="docutils literal notranslate"><span class="pre">Pre-Trial</span> <span class="pre">Interval</span></code>. If this option is enabled, and the chooser is set to “Yes”,
then a <code class="docutils literal notranslate"><span class="pre">preTrialStim</span></code> sound needs to be passed to the <code class="docutils literal notranslate"><span class="pre">playRandomisedIntervals</span></code>
function. This sound will be presented at the beginning of each trial.</p></li>
</ul>
</section>
<section id="the-play-sound-functions">
<span id="sec-play-sound-functions"></span><h2>The Play Sound Functions<a class="headerlink" href="#the-play-sound-functions" title="Permalink to this heading"></a></h2>
<div class="admonition-todo admonition" id="id12">
<p class="admonition-title">Todo</p>
<p>Illustrate the functions to play sounds</p>
</div>
</section>
<section id="simulations">
<span id="sec-simulations"></span><h2>Simulations<a class="headerlink" href="#simulations" title="Permalink to this heading"></a></h2>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">pychoacoustics</span></code> is not designed to run simulations in itself, however it provides a hook to redirect the control flow to an auditory model that you need to specify yourself in the experiment file.  You can retrieve the current response mode from the experiment file with:</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;allBlocks&#39;</span><span class="p">][</span><span class="s1">&#39;responseMode&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>so, in the experiment file, after the creation of the stimuli for the trial you can redirect the control flow of the program depending on the response mode:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;allBlocks&#39;</span><span class="p">][</span><span class="s1">&#39;responseMode&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Simulated Listener&quot;</span><span class="p">:</span>
<span class="linenos"> 2</span>    <span class="c1">#we are not in simulation mode, play the stimuli for the listener</span>
<span class="linenos"> 3</span>    <span class="n">parent</span><span class="o">.</span><span class="n">playSoundSequence</span><span class="p">(</span><span class="n">sndSeq</span><span class="p">,</span> <span class="n">ISIs</span><span class="p">)</span>
<span class="linenos"> 4</span> <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;allBlocks&#39;</span><span class="p">][</span><span class="s1">&#39;responseMode&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Simulated Listener&quot;</span><span class="p">:</span>
<span class="linenos"> 5</span>    <span class="c1">#we are in simulation mode</span>
<span class="linenos"> 6</span>    <span class="c1">#pass the stimuli to an auditory model and decision device</span>
<span class="linenos"> 7</span>    <span class="c1">#---</span>
<span class="linenos"> 8</span>    <span class="c1">#Here you specify your model, pychoacoustics doesn&#39;t do it for you!</span>
<span class="linenos"> 9</span>    <span class="c1"># at the end your simulated listener arrives to a response that is</span>
<span class="linenos">10</span>    <span class="c1"># either correct or incorrect</span>
<span class="linenos">11</span>    <span class="c1">#---</span>
<span class="linenos">12</span>    <span class="n">parent</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;trialRunning&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">13</span>    <span class="c1">#this is needed for technical reasons (if the &#39;trialRunning&#39;</span>
<span class="linenos">14</span>    <span class="c1">#flag were set to &#39;True&#39; pychoacoustics would not process</span>
<span class="linenos">15</span>    <span class="c1">#the response.</span>
<span class="linenos">16</span>    <span class="c1">#</span>
<span class="linenos">17</span>    <span class="c1">#let&#39;s suppose that at the end of the simulation you store the</span>
<span class="linenos">18</span>    <span class="c1">#response in a variable called &#39;resp&#39;, that can take as values</span>
<span class="linenos">19</span>    <span class="c1">#either the string &#39;Correct&#39; or the string &#39;Incorrect&#39;.</span>
<span class="linenos">20</span>    <span class="c1">#You can then proceed to let pychoacoustics process the response:</span>
<span class="linenos">21</span>    <span class="c1">#</span>
<span class="linenos">22</span>    <span class="k">if</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;Correct&#39;</span><span class="p">:</span>
<span class="linenos">23</span>       <span class="n">parent</span><span class="o">.</span><span class="n">sortResponse</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">correctButton</span><span class="p">)</span>
<span class="linenos">24</span>    <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;Incorrect&#39;</span><span class="p">:</span>
<span class="linenos">25</span>       <span class="c1">#list all the possible &#39;incorrect&#39; buttons</span>
<span class="linenos">26</span>       <span class="n">inc_buttons</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
<span class="linenos">27</span>                                  <span class="bp">self</span><span class="o">.</span><span class="n">prm</span><span class="p">[</span><span class="s1">&#39;nAlternatives&#39;</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
<span class="linenos">28</span>                                  <span class="bp">self</span><span class="o">.</span><span class="n">correctButton</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="linenos">29</span>       <span class="c1">#choose one of the incorrect buttons</span>
<span class="linenos">30</span>       <span class="n">parent</span><span class="o">.</span><span class="n">sortResponse</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">inc_buttons</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="engine.html" class="btn btn-neutral float-left" title="The pychoacoustics Engine" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="troubleshooting.html" class="btn btn-neutral float-right" title="Troubleshooting" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2008-2024, Samuele Carcagno.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>